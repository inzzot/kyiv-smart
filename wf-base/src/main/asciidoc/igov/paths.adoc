== Resources
=== AccessCommonController — Доступ Общий (права Доступа К Сервисам)
:hardbreaks:
Access Common Controller

==== Добавить/обновить объект-связку включение одного права, другим правом
----
POST /access/setAccessServiceRoleRightInclude
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект-связку, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки права и включенного права|false|integer (int64)|
|QueryParameter|nID_AccessServiceRole|Строка логин пользователя|true|integer (int64)|
|QueryParameter|nID_AccessServiceRole_Include|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект-связку включение одного права, другим правом|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавить/обновить объект-связку включение одного права, другим правом
----
GET /access/setAccessServiceRoleRightInclude
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект-связку, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки права и включенного права|false|integer (int64)|
|QueryParameter|nID_AccessServiceRole|Строка логин пользователя|true|integer (int64)|
|QueryParameter|nID_AccessServiceRole_Include|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект-связку включение одного права, другим правом|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получить массив объектов-прав на сервис по фильтру
----
GET /access/getAccessServiceRights
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД права|false|integer (int64)|
|QueryParameter|sService|строка-сервис (маска)|false|string|
|QueryParameter|saMethod|строка-название метода вызова|false|string|
|QueryParameter|sHandlerBean|строка-название бина-обработчика|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Проверка разрешения на доступ к сервису для пользователя
----
GET /access/hasAccessServiceLoginRight
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/access/hasAccessServiceLoginRight?sLogin=SomeLogin&sService=access/hasAccessServiceLoginRight&sMethod=GET

```
Ответ false

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|Строка логин пользователя|true|string|
|QueryParameter|sService|Строка название сервиса|true|string|
|QueryParameter|sData|Строка параметр со строкой параметров к сервису (формат передачи пока не определен)|false|string|
|QueryParameter|sMethod|Метод доступа к свервису (GET или POST или другиие)|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|true - если у пользоватля с логином sLogin есть доступ к рест-сервиcу sService при вызове его с аргументами sData, или false - если доступа нет.|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|500|Ошибка бизнес-процесса|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-роли
----
POST /access/removeAccessServiceRole
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-роли
----
GET /access/removeAccessServiceRole
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-право на сервис
----
POST /access/removeAccessServiceRight
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД права|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-право на сервис
----
GET /access/removeAccessServiceRight
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД права|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавить/обновить объект-связку роли на право доступа к сервису
----
POST /access/setAccessServiceRoleRight
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект связку роли на право, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки права и роли|false|integer (int64)|
|QueryParameter|nID_AccessServiceRole|строка логин пользователя|true|integer (int64)|
|QueryParameter|nID_AccessServiceRight|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект-связку роли на право доступа к сервису|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавить/обновить объект-связку роли на право доступа к сервису
----
GET /access/setAccessServiceRoleRight
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект связку роли на право, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки права и роли|false|integer (int64)|
|QueryParameter|nID_AccessServiceRole|строка логин пользователя|true|integer (int64)|
|QueryParameter|nID_AccessServiceRight|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект-связку роли на право доступа к сервису|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавить/обновить объект-права на сервис
----
POST /access/setAccessServiceRight
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект-право, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД права|true|integer (int64)|
|QueryParameter|sName|строка-название|true|string|
|QueryParameter|nOrder|номер порядка (проверки)|false|integer (int32)|
|QueryParameter|sService|строка-сервис|false|string|
|QueryParameter|saMethod|строка-название метода вызова|false|string|
|QueryParameter|sHandlerBean|строка-название бина-обработчика|false|string|
|QueryParameter|bDeny|булевый, запретить доступ к сервису?|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий объект-права на сервис|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавить/обновить объект-права на сервис
----
GET /access/setAccessServiceRight
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект-право, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД права|true|integer (int64)|
|QueryParameter|sName|строка-название|true|string|
|QueryParameter|nOrder|номер порядка (проверки)|false|integer (int32)|
|QueryParameter|sService|строка-сервис|false|string|
|QueryParameter|saMethod|строка-название метода вызова|false|string|
|QueryParameter|sHandlerBean|строка-название бина-обработчика|false|string|
|QueryParameter|bDeny|булевый, запретить доступ к сервису?|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий объект-права на сервис|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-связку включение одного права, другим правом
----
POST /access/removeAccessServiceRoleRightInclude
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки права и права|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-связку включение одного права, другим правом
----
GET /access/removeAccessServiceRoleRightInclude
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки права и права|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-связку роли на право доступа к сервису
----
POST /access/removeAccessServiceRoleRight
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки роли и права|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удалить объект-связку роли на право доступа к сервису
----
GET /access/removeAccessServiceRoleRight
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки роли и права|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавить/обновить объект-роли
----
POST /access/setAccessServiceRole
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект роли, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД роли|false|integer (int64)|
|QueryParameter|sName|строка-название|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект роли|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавить/обновить объект-роли
----
GET /access/setAccessServiceRole
----

===== Description
:hardbreaks:
Если задан nID, то обновляет обьект роли, если нет - создает новый

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД роли|false|integer (int64)|
|QueryParameter|sName|строка-название|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект роли|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Авторизирует пользователя и возвращает соответсвующую ему структуру объектов
----
POST /access/loginSubject
----

===== Description
:hardbreaks:
##### При вводе корректных данных метод возвращает код 200 и, при этом, открывается сессия и возвращается структура объектов, которая соответсвует этому пользователю.
 Если же пользователя с таким логином и паролем не существует, - то вернется ошибка с кодом LI_0001 и сообщением Login or password invalid.


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|Строка логин пользователя|true|string|kermit
|BodyParameter|sPassword|Строка пароль пользователя|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаление роли с логина
----
POST /access/removeAccessServiceLoginRole
----

===== Description
:hardbreaks:
Удаление происходит либо по nID связки, либо по парезначений sLogin и nID_AccessServiceRole.

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки|false|integer (int64)|
|QueryParameter|sLogin|строка-логин|false|string|
|QueryParameter|nID_AccessServiceRole|номер-ИД роли|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаление роли с логина
----
GET /access/removeAccessServiceLoginRole
----

===== Description
:hardbreaks:
Удаление происходит либо по nID связки, либо по парезначений sLogin и nID_AccessServiceRole.

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД связки|false|integer (int64)|
|QueryParameter|sLogin|строка-логин|false|string|
|QueryParameter|nID_AccessServiceRole|номер-ИД роли|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Сервис верификации контакта - электронного адреса
----
GET /access/verifyContactEmail
----

===== Description
:hardbreaks:
##### Примеры:
https://test.region.igov.org.ua/wf/service/access/verifyContactEmail?sQuestion=\test@igov.org.ua
Response

```json
{
    "bVerified":true,
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sQuestion|Строка запрос (электронный адрес)|true|string|
|QueryParameter|sAnswer|Строка ответ (код )|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получить массив объеков ролей с правами в виде дерева
----
GET /access/getAccessServiceRoleRights
----

===== Description
:hardbreaks:
Если задан nID_AccessServiceRole то возвращает права для этой роли, если нет - то для всех ролей.

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_AccessServiceRole|номер-ИД роли|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

====  Аутентификация пользователя. Логаут пользователя (наличие cookie JSESSIONID)
----
POST /access/logout
----

===== Description
:hardbreaks:
##### 
Response:

```json
  {"session":"97AE7CA414A5DA85749FE379CC843796"}

```


===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Возращает JSESSIONID|<<LogoutResponseI>>
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

====  Аутентификация пользователя. Логаут пользователя (наличие cookie JSESSIONID)
----
DELETE /access/logout
----

===== Description
:hardbreaks:
##### 
Response:

```json
  {"session":"97AE7CA414A5DA85749FE379CC843796"}

```


===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Возращает JSESSIONID|<<LogoutResponseI>>
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Установить роль логина
----
POST /access/setAccessServiceLoginRole
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД|false|integer (int64)|
|QueryParameter|sLogin|Строка логин пользователя|true|string|
|QueryParameter|nID_AccessServiceRole|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект роли логина|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Установить роль логина
----
GET /access/setAccessServiceLoginRole
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД|false|integer (int64)|
|QueryParameter|sLogin|Строка логин пользователя|true|string|
|QueryParameter|nID_AccessServiceRole|номер-ИД роли|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Результирующий обьект роли логина|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Логин пользователя
----
POST /access/login
----

===== Description
:hardbreaks:
##### Response:

```json
  {"session":"true"}

```
Пример:
https://test.region.igov.org.ua/wf/access/login?sLogin=kermit&sPassword=kermit


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|Строка логин пользователя|true|string|
|QueryParameter|sPassword|Строка пароль пользователя|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Возращает признак успеха/неудачи входа:
 - **true** - Пользователь авторизирован; 
- **false** - Имя пользователя или пароль некорректны. 
|<<LoginResponseI>>
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получить массив ролей логина
----
GET /access/getAccessServiceLoginRoles
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|Строка логин пользователя|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Логин пользователя
----
POST /access/login-v2
----

===== Description
:hardbreaks:
##### Response:

```json
  {"session":"true"}

```
Пример:
https://test.region.igov.org.ua/wf/access/login?sLogin=kermit&sPassword=kermit


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|Строка логин пользователя|true|string|
|QueryParameter|sPassword|Строка пароль пользователя|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Возращает признак успеха/неудачи входа:
 - **true** - Пользователь авторизирован; 
- **false** - Имя пользователя или пароль некорректны. 
|<<LoginResponseI>>
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

=== ActionExecuteController
:hardbreaks:
Action Execute Controller

==== переместить записи из основной таблицы в олд или обратно
----
POST /action/execute/moveActionExecute
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nRowsMax|число строк максимальное (максимально - не более 1000, по умолчанию 10)|false|integer (int32)|
|QueryParameter|sMethodMask|строка-маска метода для выборки|false|string|
|QueryParameter|bOldOnly|булевый флаг, если true=только из олд-таблицы, иначе только из основной (по умолчанию false)|false|boolean|
|QueryParameter|asID_Status|массив JSON статусов для выборки|false|string|
|QueryParameter|nTryMax|число-лимит. выбрать только те, у которых число попыток не превышает указанный лимит (иначе с любым числом попыток)|false|integer (int32)|
|QueryParameter|nID|номер-ИД записи|false|integer (int64)|
|QueryParameter|bBack|булевый флаг, если указан true, то переместить из олд-а в основную (по умолчанию false)|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== переместить записи из основной таблицы в олд или обратно
----
POST /action/execute/testMail
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nRowsMax|число строк максимальное (максимально - не более 1000, по умолчанию 10)|false|integer (int32)|
|QueryParameter|sMethodMask|строка-маска метода для выборки|false|string|
|QueryParameter|bOldOnly|булевый, true=только из олд-таблицы, иначе только из основной (по умолчанию false)|false|boolean|
|QueryParameter|asID_Status|массив JSON статусов для выборки|false|string|
|QueryParameter|nTryMax|число-лимит. выбрать только те, у которых число попыток не превышает указанный лимит (иначе с любым числом попыток)|false|integer (int32)|
|QueryParameter|nID|номер-ИД записи|false|integer (int64)|
|QueryParameter|bBack|булевый, если указан true, то переместить из олд-а в основную (по умолчанию false)|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

====  получить массив всех акций
----
GET /action/execute/getActionExecute
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nRowsMax|число строк максимальное (максимально - не более 1000, по умолчанию 10)|false|integer (int32)|
|QueryParameter|sMethodMask|строка-маска метода для выборки|false|string|
|QueryParameter|bOldOnly|булевый флаг, если true=только из олд-таблицы, иначе только из основной (по умолчанию false)|false|boolean|
|QueryParameter|asID_Status|массив JSON статусов для выборки|false|string|
|QueryParameter|nTryMax|число-лимит. выбрать только те, у которых число попыток не превышает указанный лимит (иначе с любым числом попыток)|false|integer (int32)|
|QueryParameter|nID|номер-ИД записи|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== Получение массива всех акций 
----
GET /action/execute/getActionExecuteStatuses
----

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== выполнить задачи
----
POST /action/execute/runActionExecute
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nRowsMax|число строк максимальное (максимально - не более 1000, по умолчанию 10)|false|integer (int32)|
|QueryParameter|sMethodMask|строка-маска метода для выборки|false|string|
|QueryParameter|bOldOnly|булевый флаг, если true=только из олд-таблицы, иначе только из основной (по умолчанию false)|false|boolean|
|QueryParameter|asID_Status|массив JSON статусов для выборки|false|string|
|QueryParameter|nTryMax|число-лимит. выбрать только те, у которых число попыток не превышает указанный лимит (иначе с любым числом попыток)|false|integer (int32)|
|QueryParameter|nID|номер-ИД записи|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

=== ActionFlowController — Действия Очередей (слоты Потока, Расписания И Тикеты)
:hardbreaks:
Action Flow Controller

==== Резервирование тайм слота.
----
POST /action/flow/DMS/setSlotHold
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/DMS/setSlotHold

nID_Service_Private - 428sDateTime - 2016-08-17 14:05:00sSubjectFamily - SidorovsSubjectName - VladimirsSubjectSurname - PetrovichsSubjectPassport - 0101sSubjectPhone - +380666800000Пример результата


```json
{
  "reserved_to": "2016-08-14 22:28:15",
  "reserve_id": "18573",
  "interval": "15"
}
```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Service_Private|ИД услуги|true|string|
|QueryParameter|sDateTime|Дата и время в формате "YYYY-MM-DD hh:ii:ss"|true|string|
|QueryParameter|sSubjectFamily|Фамилия клиента|true|string|
|QueryParameter|sSubjectName|Имя клиента|true|string|
|QueryParameter|sSubjectSurname|Отчество клиента|true|string|
|QueryParameter|sSubjectPassport|Последние 4 цифры паспорта|true|string|
|QueryParameter|sSubjectPhone|Номер телефона клиента|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== Получение слотов по сервису сгруппированных по дням
----
GET /action/flow/getFlowSlots_ServiceData
----

===== Description
:hardbreaks:
##### Пример:
https://test.igov.org.ua/wf/service/action/flow/getFlowSlots_ServiceData?nID_ServiceData=1 
или
https://test.region.igov.org.ua/wf/service/action/flow/getSheduleFlowIncludes?sID_BP=kiev_mreo_1 
Ответ: HTTP STATUS 200


```json
{
    "aDay": [
        {
            "sDate": "2015-07-19",
            "bHasFree": true,
            "aSlot": [
                {
                    "nID": 1,
                    "sTime": "18:00",
                    "nMinutes": 15,
                    "bFree": true
                }
            ]
        },
        {
            "sDate": "2015-07-20",
            "bHasFree": true,
            "aSlot": [
                {
                    "nID": 3,
                    "sTime": "18:15",
                    "nMinutes": 15,
                    "bFree": true
                }
            ]
        }
    ]
}


```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Service|номер-ИД услуги  (обязательный если нет sID_BP и nID_ServiceData)|false|integer (int64)|
|QueryParameter|nID_ServiceData|ИД сущности ServiceData (обязательный если нет sID_BP и nID_Service)|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД бизнес-процесса (обязательный если нет nID_ServiceData и nID_Service)|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД департамента субьекта-органа|false|integer (int64)|
|QueryParameter|bAll|булевое значение, если false то из возвращаемого объекта исключаются элементы, содержащие "bHasFree":false "bFree":false (опциональный, по умолчанию false)|false|boolean|
|QueryParameter|nFreeDays|число дней со слотами будут включаться в результат пока не наберется указанное кол-во свободных дней (опциональный, по умолчанию 60)|false|integer (int32)|
|QueryParameter|nDays|число дней от сегодняшего включительно(или sDateStart, если задан), до nDays в будующее за который нужно вернуть слоты (опциональный, по умолчанию 177 - пол года)|false|integer (int32)|
|QueryParameter|nDiffDays|число дней пропуска от сегодняшнего, с которого начинать отображать расписание|false|integer (int32)|
|QueryParameter|sDateStart|строка параметр, определяющие дату начала в формате "yyyy-MM-dd", с которую выбрать слоты. При наличии этого параметра слоты возвращаются только за указанный период(число дней задается nDays)|false|string|
|QueryParameter|nSlots|число, опциональный параметр (по умолчанию 1), группировать слоты по заданному числу штук|false|integer (int32)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Успех операции: 
 Калькулируемые поля в ответе:
- флаг "bFree" - является ли слот свободным? Слот считается свободным если на него нету тикетов у которых nID_Task_Activiti равен null, а у тех у которых nID_Task_Activiti = null - время создания тикета (sDateEdit) не позднее чем текущее время минус 5 минут (предопределенная константа)
- флаг "bHasFree" равен true , если данных день содержит хотя бы один свободный слот.
|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение расписаний исключений
----
GET /action/flow/getSheduleFlowExcludes
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/getSheduleFlowExcludes?nID_Flow_ServiceData=1

Пример результата

```json
[
  {
    "sData": null,
    "bExclude": true,
    "sName": "Test",
    "sRegionTime": "10:30-11:30",
    "saRegionWeekDay": "mo,tu"
    "sDateTimeAt": "2010-08-01 10:10:30",
    "sDateTimeTo": "2010-08-01 18:10:00",
    "nID": 20367,
    "nID_FlowPropertyClass": {
      "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
      "sBeanName": "defaultFlowSlotScheduler",
      "nID": 1,
      "sName": "DefaultFlowSlotScheduler"
    }
  },
  {
    "sData": null,
    "bExclude": false,
    "sName": "Test",
    "sRegionTime": "10:30-11:30",
    "saRegionWeekDay": "mo,tu",
    "sDateTimeAt": "10:30",
    "sDateTimeTo": "12:30",
    "nID": 20364,
    "nID_FlowPropertyClass": {
      "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
      "sBeanName": "defaultFlowSlotScheduler",
      "nID": 1,
      "sName": "DefaultFlowSlotScheduler"
    }
  }
]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Flow_ServiceData|ИД потока|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД БизнесПроцесса|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД номер-ИН департамента|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<FlowProperty>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение расписаний включений
----
GET /action/flow/getSheduleFlowIncludes
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/getSheduleFlowIncludes?nID_Flow_ServiceData=1

Пример результата


```json
[
  {
    "sData": null,
    "bExclude": false,
    "sName": "Test",
    "sRegionTime": ""10:30-11:30"",
    "saRegionWeekDay": ""mo,tu"",
    "sDateTimeAt": ""2010-08-01 10:10:30"",
    "sDateTimeTo": ""2010-08-01 18:10:00"",
    "nID": 20367,
    "nID_FlowPropertyClass": {
      "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
      "sBeanName": "defaultFlowSlotScheduler",
      "nID": 1,
      "sName": "DefaultFlowSlotScheduler"
    }
  },
  {
    "sData": null,
    "bExclude": false,
    "sName": "Test",
    "sRegionTime": "10:30-11:30",
    "saRegionWeekDay": "mo,tu",
    "sDateTimeAt": "10:30",
    "sDateTimeTo": "12:30",
    "nID": 20364,
    "nID_FlowPropertyClass": {
      "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
      "sBeanName": "defaultFlowSlotScheduler",
      "nID": 1,
      "sName": "DefaultFlowSlotScheduler"
    }
  }
]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Flow_ServiceData|ИД потока|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД БизнесПроцесса|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД номер-ИН департамента|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<FlowProperty>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавление/изменение расписания включений
----
GET /action/flow/setSheduleFlowInclude
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/setSheduleFlowInclude?nID_Flow_ServiceData=1&sName=Test&sRegionTime=%2210:30-11:30%22&sDateTimeAt=%222010-08-01%2010:10:30%22&sDateTimeTo=%222010-08-01%2018:10:00%22&saRegionWeekDay=%22mo,tu%22
Пример результата

```json
{
  "sData": null,
  "bExclude": false,
  "sName": "Test",
  "sRegionTime": "10:30-11:30",
  "saRegionWeekDay": "mo,tu",
  "sDateTimeAt": "2010-08-01 10:10:30",
  "sDateTimeTo": "2010-08-01 18:10:00",
  "nID": 20367,
  "nID_FlowPropertyClass": {
    "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
    "sBeanName": "defaultFlowSlotScheduler",
    "nID": 1,
    "sName": "DefaultFlowSlotScheduler"
  }
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|ИД-номер, если задан - редактирование|false|integer (int64)|
|QueryParameter|nID_Flow_ServiceData|номер-ИД потока (обязательный если нет sID_BP)|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД бизнес-процесса потока (обязательный если нет nID_Flow_ServiceData)|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД номер-ИН департамента|false|integer (int64)|
|QueryParameter|sName|Строка-название ("Вечерний прием")|true|string|
|QueryParameter|sRegionTime|Строка период времени ("14:16-16-30")|true|string|
|QueryParameter|nLen|Число, определяющее длительность слота|false|integer (int32)|
|QueryParameter|sLenType|Строка определяющее тип длительности слота|false|string|
|QueryParameter|sData|Строка с данными(выражением), описывающими формулу расписания (например: {"0 0/30 9-12 ? * TUE-FRI":"PT30M"})|false|string|
|QueryParameter|saRegionWeekDay|Массив дней недели ("su,mo,tu")|true|string|
|QueryParameter|sDateTimeAt|Строка-дата начала(на) в формате YYYY-MM-DD hh:mm:ss ("2015-07-31 19:00:00")|true|string|
|QueryParameter|sDateTimeTo|Строка-дата конца(к) в формате YYYY-MM-DD hh:mm:ss ("2015-07-31 23:00:00")|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<FlowProperty>>
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Генерация слотов на заданный интервал для заданного потока
----
POST /action/flow/buildFlowSlots
----

===== Description
:hardbreaks:
##### Пример:
 http://test.igov.org.ua/wf/service/action/flow/buildFlowSlots
- nID_Flow_ServiceData=1
- sDateStart=2015-06-01 00:00:00.000
- sDateStop=2015-06-07 00:00:00.000
Ответ: HTTP STATUS 200.
Ниже приведена часть json ответа:

```json
[
    {
        "nID": 1000,
        "sTime": "08:00",
        "nMinutes": 15,
        "bFree": true
    },
    {
        "nID": 1001,
        "sTime": "08:15",
        "nMinutes": 15,
        "bFree": true
    },
    {
        "nID": 1002,
        "sTime": "08:30",
        "nMinutes": 15,
        "bFree": true
    },
...
]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Flow_ServiceData|номер-ИД потока (обязательный если нет sID_BP)|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД бизнес-процесса потока (обязательный если нет nID_Flow_ServiceData)|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД номер-ИН департамента|false|integer (int64)|
|QueryParameter|sDateStart|строка дата, начиная с такого-то момента времени, в формате "2015-06-28 12:12:56.001"|false|string|
|QueryParameter|sDateStop|строка дата, заканчивая к такому-то моменту времени, в формате "2015-07-28 12:12:56.001"|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|json перечисление всех сгенерированных слотов
Если на указанные даты слоты уже сгенерены то они не будут генерится повторно, и в ответ включаться не будут.|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Подтверждение резервации тайм слота.
----
POST /action/flow/DMS/setSlot
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/DMS/setSlot

nID_SlotHold - 18573Пример результата


```json
{
  "patronymic": "Petrovich",
  "date_time": "2016-08-17 14:05:00",
  "ticket_code": "418303677",
  "service_id": "428",
  "name": "Vladimir",
  "ticket_number": "501",
  "lastname": "Sidorov"
}
```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_SlotHold|ИД слота резервации|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== Удаление слотов на заданный интервал для заданного потока
----
DELETE /action/flow/clearFlowSlots
----

===== Description
:hardbreaks:
##### Пример:

```
http://test.igov.org.ua/wf/service/action/flow/clearFlowSlots?nID_Flow_ServiceData=1&sDateStart=2015-06-01 00:00:00.000&sDateStop=2015-06-07 00:00:00.000


```
Ответ: HTTP STATUS 200 
Ниже приведена часть json ответа:


```json
{
    "aDeletedSlot": [
        {
            "nID": 1000,
            "sTime": "08:00",
            "nMinutes": 15,
            "bFree": true
        },
        {
            "nID": 1001,
            "sTime": "08:15",
            "nMinutes": 15,
            "bFree": true
        },
        ...
     ],
     "aSlotWithTickets": []
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Flow_ServiceData|номер-ИД потока (обязательный если нет sID_BP)|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД бизнес-процесса потока (обязательный если нет nID_Flow_ServiceData)|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД номер-ИН департамента|false|integer (int64)|
|QueryParameter|sDateStart|строка дата, начиная с такого-то момента времени, в формате "2015-06-28 12:12:56.001"|true|string|
|QueryParameter|sDateStop|строка дата, заканчивая к такому-то моменту времени, в формате "2015-07-28 12:12:56.001"|true|string|
|QueryParameter|bWithTickets|булевое значение удалять ли слоты с тикетами, отвязывая тикеты от слотов? (опциональный, по умолчанию false). 
 Если bWithTickets=true то эти слоты тоже удаляются и будут перечислены в aDeletedSlot, 
 иначе - не удаляются.|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|json Обьект содержащий 2 списка:
- aDeletedSlot - удаленные слоты
- aSlotWithTickets - слоты с тикетами.
  Если bWithTickets=true то эти слоты тоже удаляются и будут перечислены в aDeletedSlot,
 иначе - не удаляются.
|object
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение активных тикетов
----
GET /action/flow/getFlowSlotTickets
----

===== Description
:hardbreaks:
##### Примеры:
https://test.region.igov.org.ua/wf/service/action/flow/getFlowSlotTickets?sLogin=kermit

```json
[
  {
    "sDateStart": "2015-07-20T15:15:00",
    "sDateEdit": "2015-07-06T11:03:52",
    "sTaskDate": "2015-07-30T10:03:43",
    "sDateFinish": "2015-07-20T15:30:00",
    "nID_FlowSlot": "6",
    "sNameBP": "Киев - Реєстрація авто з пробігом в МРЕВ",
    "nID_Subject": "20045",
    "sUserTaskName": "Надання послуги: Огляд авто",
    "nID": "20005"
  },
  {
    "sDateStart": "2015-07-20T15:45:00",
    "sDateEdit": "2015-07-06T23:25:15",
    "sTaskDate": "2015-07-06T23:27:18",
    "sDateFinish": "2015-07-20T16:00:00",
    "nID_FlowSlot": "7",
    "sNameBP": "Киев - Реєстрація авто з пробігом в МРЕВ",
    "nID_Subject": "20045",
    "sUserTaskName": "Надання послуги: Огляд авто",
    "nID": "20010"
  }
]

```

https://test.region.igov.org.ua/wf/service/action/flow/getFlowSlotTickets?sLogin=kermit&bEmployeeUnassigned=true

```json
[
  {
    "sDateStart": "2015-08-03T08:00:00",
    "sDateEdit": "2015-07-30T23:10:58",
    "sTaskDate": "2015-07-30T23:50:07",
    "sDateFinish": "2015-08-03T08:15:00",
    "nID_FlowSlot": "20086",
    "sNameBP": "Днепропетровск - Реєстрація авто з пробігом в МРЕВ",
    "nID_Subject": "20045",
    "sUserTaskName": "Друк держ.номерів",
    "nID": "20151"
  },
  {
    "sDateStart": "2015-08-03T08:15:00",
    "sDateEdit": "2015-07-31T21:00:56",
    "sTaskDate": "2015-07-31T21:01:19",
    "sDateFinish": "2015-08-03T08:30:00",
    "nID_FlowSlot": "20023",
    "sNameBP": "Киев - Реєстрація авто з пробігом в МРЕВ",
    "nID_Subject": "20045",
    "sUserTaskName": "Перевірка наявності обтяжень",
    "nID": "20357"
  }
]

```

https://test.region.igov.org.ua/wf/service/action/flow/getFlowSlotTickets?sLogin=kermit&bEmployeeUnassigned=true&sDate=2015-07-20

```json
[
  {
    "sDateStart": "2015-07-20T15:15:00",
    "sDateEdit": "2015-07-06T11:03:52",
    "sTaskDate": "2015-07-30T10:03:43",
    "sDateFinish": "2015-07-20T15:30:00",
    "nID_FlowSlot": "6",
    "sNameBP": "Киев - Реєстрація авто з пробігом в МРЕВ",
    "nID_Subject": "20045",
    "sUserTaskName": "Надання послуги: Огляд авто",
    "nID": "20005"
  },
  {
    "sDateStart": "2015-07-20T15:45:00",
    "sDateEdit": "2015-07-06T23:25:15",
    "sTaskDate": "2015-07-06T23:27:18",
    "sDateFinish": "2015-07-20T16:00:00",
    "nID_FlowSlot": "7",
    "sNameBP": "Киев - Реєстрація авто з пробігом в МРЕВ",
    "nID_Subject": "20045",
    "sUserTaskName": "Надання послуги: Огляд авто",
    "nID": "20010"
  }
]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|строка имя пользователя для которого необходимо вернуть тикеты|true|string|
|QueryParameter|bEmployeeUnassigned|булевое значение опциональный параметр (false по умолчанию). Если true - возвращать тикеты не заассайненые на пользователей|false|boolean|
|QueryParameter|sDate|строка опциональный параметр в формате yyyy-MM-dd. Дата за которую выбирать тикеты. При выборке проверяется startDate тикета (без учета времени. только дата). Если день такой же как и у указанное даты - такой тикет добавляется в результат.|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== Добавление/изменение расписания исключения
----
GET /action/flow/setSheduleFlowExclude
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/setSheduleFlowExclude?nID_Flow_ServiceData=1&sName=Test&sRegionTime=%2210:30-11:30%22&sDateTimeAt=%222010-08-01%2010:10:30%22&sDateTimeTo=%222010-08-01%2018:10:00%22&saRegionWeekDay=%22mo,tu%22

```json
Пример результата
{
  "sData": null,
  "bExclude": true,
  "sName": "Test",
  "sRegionTime": "10:30-11:30",
  "saRegionWeekDay": "mo,tu",
  "sDateTimeAt": "2010-08-01 10:10:30",
  "sDateTimeTo": "2010-08-01 18:10:00",
  "nID": 20367,
  "nID_FlowPropertyClass": {
    "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
    "sBeanName": "defaultFlowSlotScheduler",
    "nID": 1,
    "sName": "DefaultFlowSlotScheduler"
  }
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|ИД-номер //опциональный ,если задан - редактирование|false|integer (int64)|
|QueryParameter|nID_Flow_ServiceData|номер-ИД потока (обязательный если нет sID_BP)|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД бизнес-процесса потока (обязательный если нет nID_Flow_ServiceData)|false|string|
|QueryParameter|nID_SubjectOrganDepartment|номер-ИН департамента|false|integer (int64)|
|QueryParameter|sName|Строка-название ("Вечерний прием")|true|string|
|QueryParameter|sRegionTime|Строка период времени ("14:16-16-30")|true|string|
|QueryParameter|nLen|Число, определяющее длительность слота|false|integer (int32)|
|QueryParameter|sLenType|Строка определяющее тип длительности слота|false|string|
|QueryParameter|sData|Строка с данными(выражением), описывающими формулу расписания (например: {"0 0/30 9-12 ? * TUE-FRI":"PT30M"})|false|string|
|QueryParameter|saRegionWeekDay|Массив дней недели ("su,mo,tu")|true|string|
|QueryParameter|sDateTimeAt|Строка-дата начала(на) в формате YYYY-MM-DD hh:mm:ss ("2015-07-31 19:00:00")|true|string|
|QueryParameter|sDateTimeTo|Строка-дата конца(к) в формате YYYY-MM-DD hh:mm:ss ("2015-07-31 23:00:00")|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<FlowProperty>>
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение массива объектов SubjectOrganDepartment по ID бизнес процесса
----
GET /action/flow/getFlowSlots_Department
----

===== Description
:hardbreaks:
##### Примеры:
 https://test.region.igov.org.ua/wf/service/action/flow/getFlowSlots_Department?sID_BP=dnepr_dms-89
Ответ:

```json
[
  {
    "sName": "ДМС, Днепр, пр. Ильича, 3 (dnepr_dms-89,dnepr_dms-89s)",
    "nID_SubjectOrgan": 2,
    "sGroup_Activiti": "dnepr_dms_89_bab",
    "nID": 13
  },
  {
    "sName": "ДМС, Днепр, вул. Шевченко, 7 (dnepr_dms-89,dnepr_dms-89s)",
    "nID_SubjectOrgan": 2,
    "sGroup_Activiti": "dnepr_dms_89_zhovt",
    "nID": 14
  }
]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_BP|строка имя Activiti BP|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|возвращает массив объектов SubjectOrganDepartment для указанного Activiti BP|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Создание или обновление тикета в указанном слоте.
----
POST /action/flow/setFlowSlot_ServiceData
----

===== Description
:hardbreaks:
##### Пример:
 http://test.igov.org.ua/wf/service/action/flow/setFlowSlot_ServiceData

- nID_FlowSlot=1
- nID_Subject=2

Ответ: HTTP STATUS 200


```json
{ "nID_Ticket": 1000 }

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_FlowSlot|ИД сущности FlowSlot|true|integer (int64)|
|QueryParameter|nID_Subject|ИД сущности Subject — субьект пользователь услуги, который подписывается на слот|true|integer (int64)|
|QueryParameter|nID_Task_Activiti|ИД таски активити процесса предоставления услуги (не обязательный — вначале он null, а потом засчитывается после подтверждения тикета и создания процесса)|false|integer (int64)|
|QueryParameter|nSlots|Кол-во слотов идущих подряд включая текущий (без зазоров времени между соседними), которые надо зарезервировать|true|integer (int32)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Поля в ответе:
 -поле "nID_Ticket" - ID созданной/измененной сущности FlowSlotTicket.
|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаление расписания исключений
----
GET /action/flow/removeSheduleFlowExclude
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/removeSheduleFlowExclude?nID_Flow_ServiceData=1&nID=20367

Пример результата


```json
{
  "sData": null,
  "bExclude": true,
  "sName": "Test",
  "sRegionTime": "10:30-11:30",
  "saRegionWeekDay": "mo,tu",
  "sDateTimeAt": "2010-08-01 10:10:30",
  "sDateTimeTo": "2010-08-01 18:10:00",
  "nID": 20367,
  "nID_FlowPropertyClass": {
    "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
    "sBeanName": "defaultFlowSlotScheduler",
    "nID": 1,
    "sName": "DefaultFlowSlotScheduler"
  }
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|ИД-номер|true|integer (int64)|
|QueryParameter|nID_Flow_ServiceData|номер-ИД потока (обязательный если нет sID_BP)|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД бизнес-процесса потока (обязательный если нет nID_Flow_ServiceData)|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД номер-ИН департамента|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<FlowProperty>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаление расписания включений
----
GET /action/flow/removeSheduleFlowInclude
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/removeSheduleFlowInclude?nID_Flow_ServiceData=1&nID=20367

Пример результата

```json
{
  "sData": null,
  "bExclude": false,
  "sName": "Test",
  "sRegionTime": "10:30-11:30",
  "saRegionWeekDay": "mo,tu",
  "sDateTimeAt": "2010-08-01 10:10:30",
  "sDateTimeTo": "2010-08-01 18:10:00",
  "nID": 20367,
  "nID_FlowPropertyClass": {
    "sPath": "org.igov.service.business.flow.handler.DefaultFlowSlotScheduler",
    "sBeanName": "defaultFlowSlotScheduler",
    "nID": 1,
    "sName": "DefaultFlowSlotScheduler"
  }
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД записи|true|integer (int64)|
|QueryParameter|nID_Flow_ServiceData|номер-ИД потока (обязательный если нет sID_BP)|false|integer (int64)|
|QueryParameter|sID_BP|строка-ИД бизнес-процесса потока (обязательный если нет nID_Flow_ServiceData)|false|string|
|QueryParameter|nID_SubjectOrganDepartment|ИД номер-ИН департамента|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<FlowProperty>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение списка тайм слотов
----
POST /action/flow/DMS/getSlots
----

===== Description
:hardbreaks:
##### Пример:
https://test.region.igov.org.ua/wf/service/action/flow/DMS/getSlots

nID_Service_Private - 428nDays - 2Пример результата


```json
{
  "2016-08-15": [
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "09:05:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "09:20:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "09:35:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "09:50:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "10:05:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "10:20:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "10:35:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "10:50:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "11:05:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "11:20:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "11:35:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "11:50:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "12:05:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "12:20:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "12:35:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "12:50:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "14:05:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "14:20:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "14:35:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "14:50:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "15:05:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "15:20:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "15:35:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "15:50:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "16:05:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "16:20:00"
    },
    {
      "date": "2016-08-15",
      "t_length": 15,
      "time": "16:35:00"
    }
  ],
  "2016-08-14": []
}
```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Service_Private|уникальный строковой-ИД сервиса|true|integer (int32)|
|QueryParameter|nDays|опциональный параметр, укзывающий количество дней для которыйх нужно найти слоты|false|integer (int32)|7
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

=== ActionIdentityCommonController
:hardbreaks:
Action Identity Common Controller

==== Возвращает список груп, если указан логин пользователя, - выводит все его групы, иначе, по умолчанию возвращает все существующие групы.
----
GET /action/identity/getGroups
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|строка текст, логин пользователя, опциональный параметр|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<Group>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаляет пользователя с указанным логином
----
DELETE /action/identity/removeUser
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|строка текст, логин пользователя, которого необходимо удалить|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавляет пользователя как члена групы
----
POST /action/identity/setUserGroup
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Group|строка текст, айди групы, в которую нужно добавить пользователя|true|string|
|QueryParameter|sLogin|строка текст, логин пользователя, которого необходимо добавить|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавление/обновление пользователя. Если пользователь с указаным логином существует, - то происходит перезапись существующих данных указанными.Если же пользователь с указанным логином не найден, - будет создана новая запись.
----
GET /action/identity/setUser
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|строка текст, логин пользователя для определения наличия пользователя в базе|true|string|
|QueryParameter|sPassword|строка текст, пароль для пользователя|true|string|
|QueryParameter|sName|строка текст, имя пользователя|true|string|
|QueryParameter|sDescription|строка текст, фамилия пользователя|true|string|
|QueryParameter|sEmail|строка текст, имейл пользователя, опциональный параметр|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаляет членство пользователя в групе
----
DELETE /action/identity/removeUserGroup
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Group|строка текст, айди групы, из которой необходимо удалить юзера|true|string|
|QueryParameter|sLogin|строка текст, логин пользователя, которого необходимо удалить|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавление/обновление групы. Если група с указаным id существует, - то происходит перезапись существующих данных указанными.Если же група с указанным id не найдена, - будет создана новая запись.
----
GET /action/identity/setGroup
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID|строка, которая содержит число, id групы|true|string|
|QueryParameter|sName|строка текст, название групы|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Возвращает список пользователей, если указан id групы, - выводит всех ее пользователей, иначе, по умолчанию возвращает всех существующие пользователей.
----
GET /action/identity/getUsers
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Group|строка, которая содержит число, id групы, опциональный параметр|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<Map«string,string»>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаляет групу с указаным id. Если група содержит пользователей, - будет выброшена ошибка которая будет содержать данные о списке пользователей в этой групе. Если же група имеет задание (таску) то при попытке ее удалить будет получена ошибка, которая будет содержать данные о списке доступных заданий.
----
DELETE /action/identity/removeGroup
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID|строка, которая содержит число, id групы|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

=== ActionTaskCommonController — Действия Общие Задач
:hardbreaks:
Action Task Common Controller

==== Получение данных по таске
----
GET /action/task/getTaskData
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Сервис получения данных по таске #####

Request:

https://test.region.igov.org.ua/wf/service/action/task/getTaskData?nID_Task=nID_Task&sID_Order=sID_Order


Response:

```json
{
  "sStatusName": название юзертаски
  "sID_Status": ИД юзертаски
  "sDateTimeCreate": дата и время создания юзертаски
  "oProcess":{
    "sName":"название услуги (БП)"
    "sBP":"id-бизнес-процесса (БП)"
    "nID":"номер-ИД процесса"
    "sDateCreate":"дата создания процесса"
  },
  "aField":[...] - массив объектов полей Таски с их атрибутами
  "oData":{...} - oбъекты электронной очереди Таски либо значение NULL, если элементов электронной очереди в таске нет
 ... другие опциональные объекты: aGroup, aFieldStartForm, aAttachment и aMessage
}

```

Элементы массива aField обычно имеют следующую структуру:
 - для активных тасок:

```json
{
  "id": идентификатор, используемый для передачи данных в форму таски
  "name": отображаемое в форме описание поля
  "type": объект типа параметра
  "value": значение параметра
  "required": свойство указывает, что поле параметра обязательно для ввода значения
  "writable": свойство указывает, что от пользователя ожидаются введенные данные в поле при отправке формы
  "readable": свойство указывает на возможность отображения параметра и его обработки методами сервисов
}

```
 - для архивных тасок:

```json
{
  "id": идентификатор параметра
  "value": представленное значение
}

```



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Task|номер-ИД таски (обязательный)|false|integer (int64)|
|QueryParameter|nID_Process|номер-ИД процесса (опциональный, но обязательный если не задан nID_Task и sID_Order)|false|integer (int64)|
|QueryParameter|sID_Order|номер-ИД заявки (опциональный, но обязательный если не задан nID_Task и nID_Process)|false|string|
|QueryParameter|sLogin|(опциональный) логин, по которому проверяется вхождение пользователя в одну из групп, на которые распространяется данная задача|false|string|
|QueryParameter|bIncludeGroups|(опциональный) если задано значение true - в отдельном элементе aGroup возвращается массив отождествленных групп, на которые распространяется данная задача|false|boolean|
|QueryParameter|bIncludeStartForm|(опциональный) если задано значение true - в отдельном элементе aFieldStartForm возвращается массив полей стартовой формы|false|boolean|
|QueryParameter|bIncludeAttachments|(опциональный) если задано значение true - в отдельном элементе aAttachment возвращается массив элементов-объектов Attachment (без самого контента)|false|boolean|
|QueryParameter|bIncludeMessages|(опциональный) если задано значение true - в отдельном элементе aMessage возвращается массив сообщений по задаче|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Загрузка данных по задачам
----
GET /action/task/downloadTasksData
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Загрузка данных по задачам #####

HTTP Context: https://server:port/wf/service/action/task/downloadTasksData


Загрузка полей по задачам в виде файла.

Поля по умолчанию, которые всегда включены в выборку:
- nID_Task - "id таски"
- sDateCreate - "дата создания таски" (в формате sDateCreateFormat)

Особенности обработки полей:
- Если тип поля enum, то брать не его ИД пункта в энуме а именно значение Если тип поля enum, и в значении присутствует знак ";", то брать только то ту часть текста, которая находится справа от этого знака

Пример: https://test.region.igov.org.ua/wf/service/action/task/downloadTasksData?&sID_BP=dnepr_spravka_o_doxodax&sID_State_BP=usertask1&sDateAt=2015-06-01&sDateTo=2015-08-01&saFields=${nID_Task};${sDateCreate};${area};;;0;${bankIdlastName} ${bankIdfirstName} ${bankIdmiddleName};4;${aim};${date_start};${date_stop};${place_living};${bankIdPassport};1;${phone};${email}&sID_Codepage=win1251&nASCI_Spliter=18&sDateCreateFormat=dd.mm.yyyy hh:MM:ss&sFileName=dohody.dat

Пример ответа:

```
1410042;16.32.2015 10:07:17;АНД (пров. Універсальний, 12);;;0;БІЛЯВЦЕВ ВОЛОДИМИР ВОЛОДИМИРОВИЧ;4;мета;16/07/2015;17/07/2015;мокешрмшгкеу;АЕ432204 БАБУШКИНСКИМ РО ДГУ УМВД 26.09.1996;1;380102030405;mendeleev.ua@gmail.com
995161;07.07.2015 05:07:27;;;;0;ДУБІЛЕТ ДМИТРО ОЛЕКСАНДРОВИЧ;4;для роботи;01/07/2015;07/07/2015;Дніпропетровська, Дніпропетровськ, вул. Донецьке шосе, 15/110;АМ765369 ЖОВТНЕВИМ РВ ДМУ УМВС УКРАЙНИ В ДНИПРОПЕТРОВСЬКИЙ ОБЛАСТИ 18.03.2002;1;;ukr_rybak@rambler.ru

```
Формат поля saFieldsCalc - смотри сервис https://github.com/e-government-ua/i/blob/test/docs/specification.md#16-Получение-статистики-по-задачам-в-рамках-бизнес-процесса и параметр saFields
Пример запроса: https://test.region.igov.org.ua/wf/service/action/task/downloadTasksData?&sID_BP=dnepr_spravka_o_doxodax&bHeader=true&sID_State_BP=usertask1&sDateAt=2015-06-01&sDateTo=2015-10-01&saFieldsCalc=%22nCount=(sID_UserTask==%27usertask1%27?1:0);nTest=(sAssignedLogin==%27kermit%27?1:0)%22

Пример ответа (фрагмент):

```
;380970044803;ДМИТРО;;ОЛЕКСАНДРОВИЧ;;dd.MM.yyyy;Днепропетровск;;;3119325858;АМ765369 ЖОВТНЕВИМ РВ ДМУ УМВС УКРАЇНИ В ДНІПРОПЕТРОВСЬКІЙ ОБЛАСТІ 18.03.2002;0463;dd.MM.yyyy;;тест;;ДУБІЛЕТ;vidokgulich@gmail.com;1.0;1.0

```
Формат поля saFieldSummary - смотри сервис https://github.com/e-government-ua/i/blob/test/docs/specification.md#16-Получение-статистики-по-задачам-в-рамках-бизнес-процесса и параметр saFieldSummary
Пример запроса: https://test.region.igov.org.ua/wf/service/action/task/downloadTasksData?&sID_BP=dnepr_spravka_o_doxodax&bHeader=true&sID_State_BP=usertask1&sDateAt=2015-06-01&sDateTo=2015-10-01&saFieldSummary=email;nVisites=count()

Пример ответа:

```
vidokgulich@gmail.com;2
kermit;1
rostislav.siryk@gmail.com;4
rostislav.siryk+igov.org.ua@gmail.com;3

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_BP|название бизнесс процесса|true|string|
|QueryParameter|sID_State_BP|состояние задачи, по умолчанию исключается из фильтра Берется из поля taskDefinitionKey задачи|false|string|
|QueryParameter|saFields|имена полей для выборкы разделенных через ';', чтобы добавить все поля можно использовать - '*' или не передевать параметр в запросе. Поле также может содержать названия колонок. Например, saFields=Passport\=${passport};{email}|false|string|
|QueryParameter|nASCI_Spliter|ASCII код для разделителя|false|string|
|QueryParameter|sFileName|имя исходящего файла, по умолчанию - data_BP-bpName_.txt"|false|string|
|QueryParameter|sID_Codepage|кодировка исходящего файла, по умолчанию - win1251|false|string|
|QueryParameter|sDateCreateFormat|форматирование даты создания таски, по умолчанию - yyyy-MM-dd HH:mm:ss|false|string|
|QueryParameter|sDateAt|начальная дата создания таски, по умолчанию - вчера|false|string (date-time)|
|QueryParameter|sDateTo|конечная дата создания таски, по умолчанию - сегодня|false|string (date-time)|
|QueryParameter|nRowStart|начало выборки для пейджирования, по умолчанию - 0|false|integer (int32)|
|QueryParameter|nRowsMax|размер выборки для пейджирования, по умолчанию - 1000|false|integer (int32)|
|QueryParameter|bIncludeHistory|включить информацию по хисторик задачам, по умолчанию - true|false|boolean|
|QueryParameter|bHeader|добавить заголовок с названиями полей в выходной файл, по умолчанию - false|false|boolean|
|QueryParameter|saFieldsCalc|настраиваемые поля (название поля -- формула, issue 907|false|string|
|QueryParameter|saFieldSummary|сведение полей, которое производится над выборкой (issue 916)|false|string|
|QueryParameter|sMailTo|Email для отправки выбранных данных|false|string|
|QueryParameter|sTaskEndDateAt|начальная дата закрытия таски|false|string (date-time)|
|QueryParameter|sTaskEndDateTo|конечная дата закрытия таски|false|string (date-time)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== getCountTask
----
GET /action/task/getCountTask
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Получение количествоа задач по нескольким наборам критериев-фильтров для указанного логина #####

HTTP Context: https://test.region.igov.org.ua/wf/service/action/task/getCountTask?sLogin=[sLogin]?&amFilter=[amFilter]


Параметры:
- sLogin - имя пользователя для которого подсчитывать количества тасок
- amFilter - массив наборов фильтров, по которым выдавать количества задач. 
Допустимые параметры внутри наборов фильтров amFilter: 
sFilterStatus - статус фильтрации задач. Значение по умолчанию - OpenedUnassigned (только не-ассайнутые), OpenedAssigned(только ассайнутые), Opened(только открытые (не в истории)), Closed(только закрытые (история))) 
bFilterHasTicket - по умолчанию false. Если true - возвращать только те задачи, у которых есть связанный тикет
bIncludeAlienAssignedTasks - по умолчанию false. Если значение false - то возвращать только свои и только не ассайнутые, к которым доступ.
Примеры:

https://test.region.igov.org.ua/wf/service/action/task/getCountTask?sLogin=kermit&amFilter=[{"bFilterHasTicket":true},{"sFilterStatus":"OpenedUnassigned"},{"sFilterStatus":"OpenedAssigned","bFilterHasTicket":true}]
Ответы: 

```json
[ 
{"nCount":5},
{"nCount":688},
{"nCount":0}
]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|sLogin|true|string|
|QueryParameter|amFilter|amFilter|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<Map«string,object»>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== getListBP
----
GET /action/task/getListBP
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_BP|строка-ИД БП //опциональный фильтр, иначе все|false|string|
|QueryParameter|sFieldType|строка-типа поля //опциональный фильтр, иначе все|false|string|
|QueryParameter|sID_Field|строка-ИД поля //опциональный фильтр, иначе все|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<ProcDefinitionI>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Вызов сервиса уточнения полей формы
----
GET /action/task/setTaskQuestions
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Вызов сервиса уточнения полей формы #####

HTTP Context: https://test.region.igov.org.ua/wf/service/action/task/setTaskQuestions?nID_Protected=nID_Protected&saField=saField&sMail=sMail


сервис запроса полей, требующих уточнения у гражданина, с отсылкой уведомления параметры:


при вызове сервиса:

- обновляется запись HistoryEvent_Service полем значениями из soData (из saField), sToken (сгенерированый случайно 20-ти символьный код), sHead, sBody (т.е. на этоп этапе могут быть ошибки, связанные с нахождением и апдейтом обьекта события по услуге)
- отсылается письмо гражданину на указанный емейл (sMail):
  с заголовком sHead,
  телом sBody
  перечисление полей из saField в формате таблицы: Поле / Тип / Текущее значение
  гиперссылкой в конце типа: https://[hostCentral]/order?nID_Protected=[nID_Protected]&sToken=[sToken]
- находитcя на региональном портале таска, которой устанавливается в глобальную переменные sQuestion содержимое sBody и saFieldQuestion - содержимое saField
- сохраняется информация о действии в Моем Журнале в виде
  По заявці №____ задане прохання уточнення: [sBody]
  плюс перечисление полей из saField в формате таблицы Поле / Тип / Текущее значение
- Пример: https://test.region.igov.org.ua/wf/service/action/task/setTaskQuestions?nID_Protected=52302969&saField=[{'id':'bankIdfirstName','type':'string','value':'3119325858'}]&sMail=test@email

Ответы: Пустой ответ в случае успешного обновления (и приход на указанный емейл письма описанного выше формата)

Возможные ошибки:

- не найдена заявка (Record not found) или ид заявки неверное (CRC Error)
- связанные с отсылкой письма, например, невалидный емейл (Error happened when sending email)
- из-за некорректных входящих данных, например неверный формат saField (пример ошибки: Expected a ',' or ']' at 72 [character 73 line 1])

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|номер-ИД процесса|true|integer (int64)|
|QueryParameter|saField|строка-массива полей|true|string|
|QueryParameter|saField|строка-массива параметров|true|string|
|QueryParameter|sMail|строка электронного адреса гражданина|true|string|
|QueryParameter|sHead|строка заголовка письма|false|string|
|QueryParameter|sBody|строка тела сообщения-коммента (общего)|false|string|
|QueryParameter|sSubjectInfo|строка информация о субьекте|false|string|
|QueryParameter|nID_Subject|номер - ИД субьекта|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

====  Центральный сервис получения контента файла
----
GET /action/task/getMessageFile_Local
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Message|номер-ИД сообщения|true|string|
|QueryParameter|nID_Process|номер-ИД процесса|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== /removeOldProcess
----
GET /action/task/removeOldProcess
----

===== Description
:hardbreaks:
##### Удаление закрытых процессов из таблиц активити#####



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|ид процесса|false|integer (int64)|
|QueryParameter|sID_Process_Def|ид бизнес-процесса|false|string|
|QueryParameter|sDateFinishAt|дата закрытия процесса с |true|string|2010-01-01
|QueryParameter|sDateFinishTo|дата закрытия процесса по |true|string|2050-01-01
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Запуск процесса Activiti
----
GET /action/task/start-process/{key}
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Запуск процесса Activiti #####

HTTP Context: https://server:port/wf/service/action/task/start-process/{key}
- nID_Subject - ID авторизированого субъекта (добавляется в запрос автоматически после аутентификации пользователя)
Request:

https://test.region.igov.org.ua/wf/service/action/task/start-process/citizensRequest

Response

```json
  {
    "id":"31"
  }

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|PathParameter|key|Ключ процесса|true|string|
|QueryParameter|organ|Орган|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<ProcessI>>
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Сервис получения значения переменной процесса
----
GET /action/task/getProcessVariableValue
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Сервис получения значения переменной процесса #####

Request:

https://test.region.igov.org.ua/wf/service/action/task/getProcessVariableValue?nID_Process=[nID_Process]&sVariableName=[sVariableName]


nID_Process - ID процесса, в котором искать переменную
sVariableName - имя переменной, значение которой необходимо вернуть
Пример: https://test.region.igov.org.ua/wf/service/action/task/getProcessVariableValue?nProcessID=8965001&sVariableName=phone
Response:

```json
  {"phone":"+380 50 960 0041"}
```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|ID процесса|true|string|
|QueryParameter|sVariableName|Название переменнной процесса значение которой необходимо найти|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== DeleteProcess
----
DELETE /action/task/delete-process-list
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: описания нет #####



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sanID_Process|sanID_Process|true|string|
|QueryParameter|sLogin|sLogin|false|string|
|QueryParameter|sReason|sReason|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Загрузка каталога сервисов из Activiti
----
GET /action/task/process-definitions
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Загрузка каталога сервисов из Activiti #####

Request:

https://test.region.igov.org.ua/wf/service/action/task/process-definitions

Response:


```json
  [
    {
      "id": "CivilCardAccountlRequest:1:9",
      "category": "http://www.activiti.org/test",
      "name": "Видача картки обліку об’єкта торговельного призначення",
      "key": "CivilCardAccountlRequest",
      "description": "Описание процесса",
      "version": 1,
      "resourceName": "dnepr-2.bpmn",
      "deploymentId": "1",
      "diagramResourceName": "dnepr-2.CivilCardAccountlRequest.png",
      "tenantId": "diver",
      "suspended": true
    }
  ]

```


===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<ProcDefinitionI>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== /closeProcess
----
GET /action/task/closeProcess
----

===== Description
:hardbreaks:
##### Закрытие всех инстансов бизнес-процесса#####



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Process_Def|ид бизнес-процесса|true|string|
|QueryParameter|nLimitCountRowDeleted|лимит количества заявок для удаления|false|integer (int32)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== GetTaskFormData
----
GET /action/task/getTaskFormData
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: описания нет #####



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Task|номер-ИД задачи|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Создание нового обьекта-записи линка
----
GET /action/task/setLink
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Сервис создания обьекта-записи линка #####

Request:

https://test.igov.org.ua/wf/service/action/task/setLink?nID_Process=nID_Process&sKey=sKey&nID_Subject_Holder=nID_Subject_Holder


Response:

```json
  {"sKey":"Cтрока-ключ",       "nID":ИД обьекта,       "nID_Process":ИД бизнес процесса,       "nID_Subject_Holder":ИД субьекта-хранителя    }

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|ИД бизнес процесса|true|integer (int64)|
|QueryParameter|sKey|Cтрока-ключ|true|string|
|QueryParameter|nID_Subject_Holder|ИД субьекта-хранителя|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<ActionTaskLink>>
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение списка бизнес процессов к которым у пользователя есть доступ
----
GET /action/task/getLoginBPs
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Получение списка бизнес процессов к которым у пользователя есть доступ #####

HTTP Context: https://test.region.igov.org.ua/wf/service/action/task/getLoginBPs?sLogin=userId

Метод возвращает json со списком бизнес процессов, к которым у пользователя есть доступ, в формате:

```json
[
  {
    "sID": "[process definition key]""sName": "[process definition name]"
  },
  {
    "sID": "[process definition key]""sName": "[process definition name]"
  }
]

```
Принадлежность пользователя к процессу проверяется по вхождению в группы, которые могут запускать usertask-и внутри процесса, или по вхождению в группу, которая может стартовать процесс

Пример:

https://test.region.igov.org.ua/wf/service/action/task/getLoginBPs?sLogin=kermit
Пример результата

```json
[
{
    "sID": "dnepr_spravka_o_doxodax",
    "sName": "Дніпропетровськ - Отримання довідки про доходи фіз. осіб"
  },
  {
    "sID": "dnepr_subsidies2",
    "sName": "Отримання субсидії на оплату житлово-комунальних послуг2"
  },
  {
    "sID": "khmelnitskij_mvk_2",
    "sName": "Хмельницький - Надання інформації, що підтверджує відсутність (наявність) земельної ділянки"
  },
  {
    "sID": "khmelnitskij_zemlya",
    "sName": "Заява про наявність земельної ділянки"
  },
  {
    "sID": "kiev_spravka_o_doxodax",
    "sName": "Київ - Отримання довідки про доходи фіз. осіб"
  },
  {
    "sID": "kuznetsovsk_mvk_5",
    "sName": "Кузнецовськ МВК - Узгодження графіка роботи підприємства торгівлі\/обслуговування"
  },
  {
    "sID": "post_spravka_o_doxodax_pens",
    "sName": "Отримання довідки про доходи (пенсійний фонд)"
  }
]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|Логин пользователя|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== Поиск заявок по тексту (в значениях полей без учета регистра)
----
GET /action/task/getTasksByText
----

===== Description
:hardbreaks:
##### Примеры:
https://test.region.igov.org.ua/wf/service/action/task/getTasksByText?sFind=будинк

```json
["4637994","4715238","4585497","4585243","4730773","4637746"]

```
https://test.region.igov.org.ua/wf/service/action/task/getTasksByText?sFind=будинк&sLogin=kermit

```json
["4637994","4715238","4585243","4730773","4637746"]

```
https://test.region.igov.org.ua/wf/service/action/task/getTasksByText?sFind=будинк&sLogin=kermit&bAssigned=false

```json
["4637994","4637746"]

```
https://test.region.igov.org.ua/wf/service/action/task/getTasksByText?sFind=будинк&sLogin=kermit&bAssigned=true

```json
["4715238","4585243","4730773"]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sFind|строка текст для поиска в полях заявки|true|string|
|QueryParameter|sLogin|строка необязательный параметр. При указании выбираются только таски, которые могут быть заассайнены или заассайнены на пользователя sLogin|false|string|
|QueryParameter|bAssigned|булево значение необязательный параметр. Указывает, что нужно искать по незаассайненным таскам (bAssigned=false) и по заассайненным таскам(bAssigned=true) на пользователя sLogin|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|возвращает список ID тасок у которых в полях встречается указанный текст|string array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Вызов сервиса ответа по полям требующим уточнения
----
GET /action/task/setTaskAnswer
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Вызов сервиса ответа по полям требующим уточнения #####

HTTP Context: https://test.region.igov.org.ua/wf/service/action/task/setTaskAnswer?nID_Protected=nID_Protected&saField=saField&sToken=sToken&sBody=sBody


- обновляет поля формы указанного процесса значениями, переданными в параметре saField Важно:позволяет обновлять только те поля, для которых в форме бизнес процесса не стоит атрибут writable="false"

Во время выполнения метод выполняет такие действия:

- Находит в сущности HistoryEvent_Service нужную запись (по nID_Protected) и сверяет токен. Eсли токен в сущности указан но не совпадает с переданным, возвращается ошибка "Token wrong". Если он в сущности не указан (null) - возвращается ошибка "Token absent".
- Находит на региональном портале таску и устанавливает в глобальную переменную sAnswer найденной таски содержимое sBody.
- Устанавливает в каждое из полей из saField новые значения
- Обновляет в сущности HistoryEvent_Service поле soData значением из saField и поле sToken значением null.
- Сохраняет информацию о действии в Мой Журнал (Текст: На заявку №____ дан ответ гражданином: [sBody])

Примеры:

https://test.region.igov.org.ua/wf/service/action/task/setTaskAnswer?nID_Protected=54352839&saField=[{%27id%27:%27bankIdinn%27,%27type%27:%27string%27,%27value%27:%271234567890%27}]&sToken=93ODp4uPBb5To4Nn3kY1

Ответы: Пустой ответ в случае успешного обновления

Токен отсутствует


```json
{"code":"BUSINESS_ERR","message":"Token is absent"}


```
Токен не совпадает со значением в HistoryEvent_Service

```json
{"code":"BUSINESS_ERR","message":"Token is absent"}


```
Попытка обновить поле с атрибутом writable="false"

```json
{"code":"BUSINESS_ERR","message":"form property 'bankIdinn' is not writable"}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|номер-ИД процесса|true|integer (int64)|
|QueryParameter|saField|saField - строка-массива полей|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== getBP
----
GET /action/task/getBP
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID|строка-ID БП|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Обработка изменения статуса документа в УкрДок
----
POST /action/task/callback/ukrdoc
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Обработка изменения статуса документа в УкрДок #####

Request:

https://test.igov.org.ua/wf/service/action/task/callback/ukrdoc


Метод выполняет следующие действия:
 - получает текущий статус документа из тега data -> docStateEvent -> state -> current 
 - получает номер документа из тега data -> docStateEvent -> tables -> CardsDocument -> CarIdDocument 
 - ищет процесс, с которым связан данный документ используя сущность ActionTaskLink. Если сущности такой еще нет - то производится поиск  по переменной процесса sID_Document, которая устанавливается при отправке документа в УкрДок, и осуществляется сохранение сущности ActionTaskLink
 - после нахождения текущей активной задачи статус из УкрДока записывается в переменную sID_Document_UkrDoc задачи
 - завершает текущую задачу. для следующей активной задачи ответственным назначает пользователя завершенной задачи. Если пользователя не было - то задача остается без активного пользователя
В теле запроса передается объект с информацией об изменении:
Образец документа:

```json
"create_time": "2016.02.05 12:51:21",
"change_time": "2016.02.05 12:51:21",
"node_prev_id": "56b0b33edfb2840b2a5644c2",
"status": "processed",
"user_id": 5850,
"data": {
    "docStateEvent": {
            "state": {
                    "current": "Не завизирован",
                    "previous": "Создан"
            },
            "pk": {
                    "id": 6569546,
                    "year": 2016
            },
            "tables": {
                    "Executors": {
                            "body": [
                                    [
                                            "DD100262LVI",
                                            null,
                                            null,
                                            "2",
                                            1,
                                            0,
                                            null,
                                            null,
                                            null,
                                            null,
                                            "0",
                                            null
                                    ]
                            ],
                            "head": {
                                    "IdAddedMethod": 11,
                                    "Lightning": 10,
                                    "ExecutData": 9,
                                    "ControlDate": 8,
                                    "AttentionExecutData": 7,
                                    "InitData": 6,
                                    "KindOrder": 5,
                                    "VisOrder": 4,
                                    "KindExecutor": 3,
                                    "peo_peo_ldap_login": 2,
                                    "io_peo_ldap_login": 1,
                                    "peo_ldap_login": 0
                            }
                    },
                    "PunctAttending": {
                            "DataPunctAttending": "2016-02-05 12:51:20",
                            "NamePunctAttending": "Создание",
                            "peo_ldap_login": "DD100262LVI"
                    },
                    "CardsDocument": {
                         "Invizible": null,
                         "LastCoordDate": null,
                         "DocCreateData": null,
                         "CoordBonDays": null,
                         "Flavor": null,
                         "IdPetm": null,
                         "Lightning": "0",
                         "Locale": "RU",
                         "DocLastModifData": "2016-02-05 12:51:20",
                         "CoordRtrnDate": "2016-02-05 12:51:20",
                         "Prioritet": "Обычный",
                         "ClassId": "a",
                         "IdKindDoc": 19,
                         "IdKindIncomming": 0,
                         "IdGroup": 1,
                         "DocumentName": "Акт перерахунку сумки",
                         "NumberDocument": "0",
                         "CarIdDocument": 6569546,
                         "IdActivity": 4842,
                         "IdXMLT": 8223,
                         "peo_peo_ldap_login": "DD100262LVI",
                         "peo_ldap_login": "DD100262LVI",
                         "IdAttending": 6569544
                 }
         },
         "uniq": 5777275,
         "dlm": "2016-02-05 12:51:20"
    },
    "__conveyor_copy_task_result__": "ok"
  }
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|BodyParameter|event|event|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение сообщений по заявке
----
GET /action/task/getOrderMessages_Local
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|номер-ИД процесса|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* text/plain;charset=UTF-8

==== removeListBP
----
GET /action/task/removeListBP
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_BP|строка-ИД БП //опциональный фильтр, иначе все|false|string|
|QueryParameter|sFieldType|строка-типа поля //опциональный фильтр, иначе все|false|string|
|QueryParameter|sID_Field|строка-ИД поля //опциональный фильтр, иначе все|false|string|
|QueryParameter|sVersion|строка-версия БП //опциональный фильтр, иначе все|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== getTasksByAssigneeGroup
----
GET /action/task/groups/{group}
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|PathParameter|group|ИД авторизированого субъекта (добавляется в запрос автоматически после аутентификации пользователя)|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<TaskAssigneeI>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== DeleteProcess
----
DELETE /action/task/delete-process
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: описания нет #####



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Order|nID_Order|true|integer (int64)|
|QueryParameter|sLogin|sLogin|false|string|
|QueryParameter|sReason|sReason|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение списка ID пользовательских тасок по номеру заявки
----
GET /action/task/getTasksByOrder
----

===== Description
:hardbreaks:
##### Примеры:
https://test.region.igov.org.ua/wf/service/action/task/getTasksByOrder?nID_Order=123452

Response status 403.


```json
{"code":"BUSINESS_ERR","message":"CRC Error"}


```
https://test.region.igov.org.ua/wf/service/action/task/getTasksByOrder?nID_Order=123451

1) Если процесса с ID 12345 и тасками нет в базе то:

Response status 403.


```json
{"code":"BUSINESS_ERR","message":"Record not found"}


```
2) Если процесс с ID 12345 есть в базе с таской ID которой 555, то:

Response status 200.

```json
[ 555 ]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Order| число номер заявки, в котором, все цифры кроме последней - ID процесса в activiti. А последняя цифра - его контрольная сумма зашифрованная по алгоритму Луна.|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Успех запроса. Если процесс с соответствующим ИД и таской найдены в базе|string array
|401|Unauthorized|No Content
|403|CRC Error или Record not found|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение статистики по задачам в рамках бизнес процесса
----
GET /action/task/download_bp_timing
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Получение статистики по задачам в рамках бизнес процесса #####

HTTP Context: https://server:port/wf/service/action/task/download_bp_timing?sID_BP_Name=XXX&sDateAt=XXX8&sDateTo=XXX


Метод возвращает .csv файл со информацией о завершенных задачах в указанном бизнес процессе за период. Если указан параметр saFieldSummary -- то также будет выполнено "сведение" полей (описано ниже). Если не указан, то формат выходного файла:

- nID_Process - ид задачи
- sLoginAssignee - кто выполнял задачу
- sDateTimeStart - Дата и время начала
- nDurationMS - Длительность выполнения задачи в миллисекундах
- nDurationHour - Длительность выполнения задачи в часах
- sName - Название задачи

Поля из FormProperty (если bDetail=true)
настраиваемые поля из saFields
Пример: https://test.region.igov.org.ua/wf/service/action/task/download_bp_timing?sID_BP_Name=lviv_mvk-1&sDateAt=2015-06-28&sDateTo=2015-07-01

Пример выходного файла

```
"Assignee","Start Time","Duration in millis","Duration in hours","Name of Task"
"kermit","2015-06-21:09-20-40","711231882","197","Підготовка відповіді на запит: пошук документа"

```
Сведение полей
параметр saFieldSummary может содержать примерно такое значение: "sRegion;nSum=sum(nMinutes);nVisites=count()"
тот элемент, который задан первым в параметре saFieldSummary - является "ключевым полем" следующие элементы состоят из названия для колонки, агрегирующей функции и названия агрегируемого поля. Например: "nSum=sum(nMinutes)"

где:

- nSum - название поля, куда будет попадать результат
- sum - оператор сведения
- nMinutes - расчетное поле переменная, которая хранит в себе значение уже существующего или посчитанного поля формируемой таблицы

Перечень поддерживаемых "операторов сведения":

- count() - число строк/элементов (не содержит аргументов)
- sum(field) - сумма чисел (содержит аргумент - название обрабатываемого поля)
- avg(field) - среднее число (содержит аргумент - название обрабатываемого поля)

Операторы можно указывать в произвольном регистре, т.е. SUM, sum и SuM "распознаются" как оператор суммы sum. 
Для среднего числа также предусмотрено альтернативное название "average".
Если в скобках не указано поле, то берется ключевое.

Значение "ключевого поля" переносится в новую таблицу без изменений в виде единой строки,и все остальные сводные поля подсчитываются исключительно в контексте
значения этого ключевого поля, и проставляютя соседними полями в рамках этой единой строки.

Особенности подсчета:

- если нету исходных данных или нету такого ключевого поля, то ничего не считается (в исходном файле просто будут заголовки)
- если расчетного поля нету, то поле не считается (т.е. сумма и количество для ключевого не меняется)
тип поля Сумма и Среднее -- дробное число, Количество -- целое. Исходя из этого при подсчете суммы значение конвертируется в число, если конвертация неудачна, то сумма не меняется. (т.е. если расчетное поле чисто текстовое, то сумма и среднее будет 0.0)

Пример: https://test.region.igov.org.ua/wf/service/action/task/download_bp_timing?sID_BP_Name=_test_queue_cancel&sDateAt=2015-04-01&sDateTo=2015-10-31&saFieldSummary=email;nSum=sum(nDurationHour);nVisites=count();nAvg=avg(nDurationHour)

Ответ:

```
"email","nSum","nVisites","nAvg"
"email1","362.0","5","72.4"
"email2","0.0","1","0.0"


```
Настраиваемые поля
Параметр saFields может содержать набор полей с выражениями, разделенными символом ; 
Вычисленное выражение, расчитанное на основании значений текущей задачи, подставляется в выходной файл 

Пример выражения 
saFields="nCount=(sID_UserTask=='usertask1'?1:0);nTest=(sAssignedLogin=='kermit'?1:0)" 
где:

- nCount, nTest - названия колонок в выходном файле
- sID_UserTask, sAssignedLogin - ID таски в бизнес процессе и пользователь, на которого заассайнена таска, соответственно

Пример: https://test.region.igov.org.ua/wf/service/action/task/download_bp_timing?sID_BP_Name=_test_queue_cancel&sDateAt=2015-04-01&sDateTo=2015-10-31&saFields="nCount=(sID_UserTask=='usertask1'?1:0);nTest=(sAssignedLogin=='kermit'?1:0)"

Результат:

```
"nID_Process","sLoginAssignee","sDateTimeStart","nDurationMS","nDurationHour","sName","bankIdPassport","bankIdfirstName","bankIdlastName","bankIdmiddleName","biometrical","date_of_visit","date_of_visit1","email","finish","have_passport","initiator","phone","urgent","visitDate","nCount","nTest"
"5207501","kermit","2015-09-25:12-18-28","1433990","0","обробка дмс","АМ765369 ЖОВТНЕВИМ РВ ДМУ УМВС УКРАЇНИ В ДНІПРОПЕТРОВСЬКІЙ ОБЛАСТІ 18.03.2002","ДМИТРО","ДУБІЛЕТ","ОЛЕКСАНДРОВИЧ","attr1_no","2015-10-09 09:00:00.00","dd.MM.yyyy HH:MI","nazarenkod1990@gmail.com","attr1_ok","attr1_yes","","38","attr1_no","{""nID_FlowSlotTicket"":27764,""sDate"":""2015-10-09 09:00:00.00""}","0.0","1.0"
"5215001","kermit","2015-09-25:13-03-29","75259","0","обробка дмс","АМ765369 ЖОВТНЕВИМ РВ ДМУ УМВС УКРАЇНИ В ДНІПРОПЕТРОВСЬКІЙ ОБЛАСТІ 18.03.2002","ДМИТРО","ДУБІЛЕТ","ОЛЕКСАНДРОВИЧ","attr1_no","2015-10-14 11:15:00.00","dd.MM.yyyy HH:MI","nazarenkod1990@gmail.com","attr1_ok","attr1_yes","","38","attr1_no","{""nID_FlowSlotTicket"":27767,""sDate"":""2015-10-14 11:15:00.00""}","0.0","1.0"
"5215055","dn200986zda","2015-09-25:13-05-22","1565056","0","обробка дмс","АМ765369 ЖОВТНЕВИМ РВ ДМУ УМВС УКРАЇНИ В ДНІПРОПЕТРОВСЬКІЙ ОБЛАСТІ 18.03.2002","ДМИТРО","ДУБІЛЕТ","ОЛЕКСАНДРОВИЧ","attr1_no","2015-09-28 08:15:00.00","dd.MM.yyyy HH:MI","dmitrij.zabrudskij@privatbank.ua","attr2_missed","attr1_yes","","38","attr1_no","{""nID_FlowSlotTicket"":27768,""sDate"":""2015-09-28 08:15:00.00""}","0.0","0.0"

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_BP_Name|ИД бизнес процесса|true|string|
|QueryParameter|sDateAt|дата начала периода выборки|false|string (date-time)|
|QueryParameter|sDateTo|дата окончания периода выборки|false|string (date-time)|
|QueryParameter|nRowStart|позиция начальной строки для возврата (0 по умолчанию)|false|integer (int32)|
|QueryParameter|nRowsMax|количество записей для возврата (1000 по умолчанию)|false|integer (int32)|
|QueryParameter|bDetail|если да, то выгружать все поля тасок, иначе -- только основные (по умолчанию да)|false|boolean|
|QueryParameter|saFieldSummary|сведение полей, которое производится над выборкой|false|string|
|QueryParameter|saFields|вычисляемые поля (название поля -- формула)|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/vnd.ms-excel

==== SendProccessToGRES
----
GET /action/task/sendProccessToGRES
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: описания нет #####



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Task|номер-ИД задачи|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== setBP
----
POST /action/task/setBP
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sFileName|Cтрока-название файла|true|string|
|FormDataParameter|file|Новий БП|false|file|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* multipart/form-data

===== Produces

* */*

==== Удаление назначенного пользователя с задачи по ИД.
----
POST /action/task/resetUserTaskAssign
----

===== Description
:hardbreaks:
#####  Request:
https://test.region.igov.org.ua/wf/service/action/task/resetUserTaskAssign

- nID_UserTask=24
Response if task assigned: HTTP STATUS 200


```json
{}

```
Response if task is not assigned: HTTP STATUS 200


```json
{"Not assigned UserTask"}


```
Response if task not found: HTTP STATUS 403 Forbidden


```json
{
"code": "BUSINESS_ERR"
"message": "Record not found"
}
```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_UserTask|номер-ИД юзертаски|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|Таска занята или же нет|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Запись о таске не найдена|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Сервис смены пароля пользователя в Activity
----
POST /action/task/changePassword
----

===== Description
:hardbreaks:
#### Примеры 
Request: 
https://test.igov.org.ua/wf/service/action/task/changePassword
sLoginOwner=kermit
sPasswordOld=kermit
sPasswordNew=kermit1
Response: Ok, 200 

 ```json
{
"userId":"kermit",
"userEmail":"kermit@activiti.org",
"userFirstName":"Kermit",
"userLastName":"The Frog"
}

```

Wrong sPasswordOld
Request:
https://test.igov.org.ua/wf/service/action/task/changePassword
sLoginOwner=kermit
sPasswordOld=kermit45
sPasswordNew=kermit1
Response: Forbidden 403

 ```json
{
"code":"BUSINESS_ERR",
"message":"Password kermit45 is wrong"
}

```

Wrong sLogin
Request:
https://test.igov.org.ua/wf/service/action/task/changePassword
sLoginOwner=kermit45
sPasswordOld=kermit
sPasswordNew=kermit1
Response: Forbidden 403

 ```json
{
"code":"BUSINESS_ERR",
"message":"Error! user has not been found"
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLoginOwner|Строка логин пользователя, меняющего пароль|true|string|
|QueryParameter|sPasswordOld|Строка старый пароль|true|string|
|QueryParameter|sPasswordNew|Строка новый пароль|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== DeleteProcess
----
DELETE /action/task/delete-process-simple
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: описания нет #####



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|nID_Process|true|string|
|QueryParameter|sLogin|sLogin|false|string|
|QueryParameter|sReason|sReason|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|204|No Content|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Отмена задачи (в т.ч. электронной очереди)
----
POST /action/task/cancelTask
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Order|номер-ИД процесса (с контрольной суммой)|true|integer (int64)|
|QueryParameter|sInfo|Строка с информацией (причиной отмены)|false|string|
|QueryParameter|bSimple|Простой вариант отмены (без электронной очереди)|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* text/plain;charset=UTF-8

==== Отмена задачи (в т.ч. электронной очереди)
----
GET /action/task/cancelTask
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Order|номер-ИД процесса (с контрольной суммой)|true|integer (int64)|
|QueryParameter|sInfo|Строка с информацией (причиной отмены)|false|string|
|QueryParameter|bSimple|Простой вариант отмены (без электронной очереди)|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* text/plain;charset=UTF-8

==== Загрузка задач из Activiti
----
GET /action/task/login/{assignee}
----

===== Description
:hardbreaks:
#####  Request:
https://test.region.igov.org.ua/wf/service/action/task/kermit

Response:

```json
    [
      {
            "delegationState": "RESOLVED",
            "id": "38",
            "name": "Первый процесс пользователя kermit",
            "description": "Описание процесса",
            "priority": 51,
            "owner": "kermit-owner",
            "assignee": "kermit-assignee",
            "processInstanceId": "12",
            "executionId": "1",
            "createTime": "2015-04-13 00:51:34.527",
            "taskDefinitionKey": "task-definition",
            "dueDate": "2015-04-13 00:51:36.527",
            "category": "my-category",
            "parentTaskId": "2",
            "tenantId": "diver",
            "formKey": "form-key-12",
            "suspended": true,
            "processDefinitionId": "21"
      }
    ]

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|PathParameter|assignee|ИД авторизированого субъекта (добавляется в запрос автоматически после аутентификации пользователя)|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<TaskAssigneeI>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Получение полей стартовой формы по ID таски
----
GET /action/task/getStartFormData
----

===== Description
:hardbreaks:
##### Примеры:
http://test.region.igov.org.ua/wf/service/action/task/getStartFormData?nID_Task=5170256
Ответ, если запись существует (HTTP status Code: 200 OK):

```json
{
  waterback="--------------------",
  phone="380979362996",
  date_from="01/01/2014",
  bankIdbirthDay="27.05.1985",
  notice2="Я та особи, які зареєстровані (фактично проживають) у житловому приміщенні/будинку, даємо згоду на обробку персональних даних про сім’ю, доходи, майно, що необхідні для призначення житлової субсидії, та оприлюднення відомостей щодо її призначення.",
house="--------------------",
  garbage="--------------------",
  waterback_notice="",
  garbage_number="",
  floors="10",
  name_services="--------------------",
  date_to="30/12/2014",
  date3="",
  date2="",
  electricity="--------------------",
  garbage_name="",
  date1="",
  place_type="2",
  bankIdfirstName="ДМИТРО",
  declaration="--------------------",
  waterback_name="",
  electricity_notice="",
  bankIdinn="3119325858",
  house_name="",
  gas="--------------------",
  house_number="",
  subsidy="1",
  email="dmitrij.zabrudskij@privatbank.ua",
  warming="--------------------",
  hotwater_notice="",
  org0="Назва організації",
  org1="",
  electricity_number="123456",
  org2="",
  org3="",
  warming_name="",
  place_of_living="Дніпропетровська, Дніпропетровськ, пр. Героїв, 17, кв 120",
  fio2="",
  fio3="",
  total_place="68",
  garbage_notice="",
  fio1="",
  chapter1="--------------------",
  bankIdmiddleName="ОЛЕКСАНДРОВИЧ",
  gas_name="",
  bankIdPassport="АМ765369 ЖОВТНЕВИМ РВ ДМУ УМВС УКРАЇНИ В ДНІПРОПЕТРОВСЬКІЙ ОБЛАСТІ 18.03.2002",
  warming_place="45",
  passport3="",
  gas_number="",
  passport2="",
  electricity_name="коммуна",
  area="samar",
  house_notice="",
  bankIdlastName="ДУБІЛЕТ",
  card1="",
  card3="",
  coolwater_number="",
  card2="",
  warming_notice="",
  hotwater_name="",
  income0="attr9",
  coolwater="--------------------",
  gas_notice="",
  overload="hxhxfhfxhfghg",
  warming_number="",
  income3="attr0",
  income1="attr0",
  income2="attr0",
  passport1="",
  coolwater_notice="",
  sBody_1="null",
  hotwater="--------------------",
  coolwater_name="",
  waterback_number="",
  man1="",
  hotwater_number="",
  sBody_2="null",
  comment="null",
  decision="null",
  selection="attr1"
}

```
Ответ, если записи не существует. (HTTP status Code: 500 Internal Server Error):


```json
{
  "code": "BUSINESS_ERR",
  "message": "Record not found"
}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Task| номер-ИД таски, для которой нужно найти процесс и вернуть поля его стартовой формы.|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|500|Record not found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== Получения обьекта-записи линка
----
GET /action/task/getLink
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Сервис получения обьекта-записи линка #####

Request:

https://test.igov.org.ua/wf/service/action/task/getLink?sKey=sKey&nID_Subject_Holder=nID_Subject_Holder


Response:

```json
  {"sKey":"Cтрока-ключ",       "nID":ИД обьекта,       "nID_Process":ИД бизнес процесса,       "nID_Subject_Holder":ИД субьекта-хранителя    }

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|ИД бизнес процесса|false|integer (int64)|
|QueryParameter|sKey|Cтрока-ключ|true|string|
|QueryParameter|nID_Subject_Holder|ИД субьекта-хранителя|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<ActionTaskLink>>
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== getTasks
----
GET /action/task/getTasks
----

===== Description
:hardbreaks:
#####  ActionCommonTaskController: Получение списка всех тасок, которые могут быть доступны указанному логину #####

HTTP Context: https://test.region.igov.org.ua/wf/service/action/task/getTasks?sLogin=[sLogin]


- Возвращает список всех тасок, которые могут быть доступны указанному логину [sLogin] и которые уже заняты другими логинами, входящими во все те-же группы, в которые входит данный логин

Во время выполнения производит поиск групп, в которые входит указанный пользователь, и затем возвращает список задач, которые могут быть  заассайнены на пользователей из полученных групп:

Содержит следующие параметры:
- sLogin - id пользователя. обязательный параметр, указывающий пользователя
- bIncludeAlienAssignedTasks - необязательный параметр (по умолчанию false). Если значение false - то возвращать только свои и только не ассайнутые, к которым доступ.
- sOrderBy - метод сортировки задач. Необязательный параметр. По умолчанию 'id'. Допустимые значения 'id', 'taskCreateTime', 'ticketCreateDate'
- nSize - Количество задач в результате. Необязательный параметр. По умолчанию 10.
- nStart - Порядковый номер первой задачи для возвращения. Необязательный параметр. По умолчанию 0
- sFilterStatus - Необязательный параметр (по умолчанию обрабатывается как OpenedUnassigned). статус фильтрации задач, у которого возможные значения: OpenedUnassigned (только не-ассайнутые),  OpenedAssigned(только ассайнутые), Opened(только открытые (не в истории)), Closed(только закрытые (история))
- bFilterHasTicket - Необязательный параметр (по умолчанию false). Если true - возвращать только те задачи, у которых есть связанный тикет
Примеры:

https://test.region.igov.org.ua/wf/service/action/task/getTasks?sLogin=kermit

https://test.region.igov.org.ua/wf/service/action/task/getTasks?sLogin=kermit&nSize=15&nStart=10



===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sLogin|sLogin|true|string|
|QueryParameter|bIncludeAlienAssignedTasks|bIncludeAlienAssignedTasks|true|boolean|
|QueryParameter|sOrderBy|sOrderBy|false|string|
|QueryParameter|nSize|nSize|false|integer (int32)|
|QueryParameter|nStart|nStart|false|integer (int32)|
|QueryParameter|sFilterStatus|sFilterStatus|false|string|
|QueryParameter|bFilterHasTicket|bFilterHasTicket|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== setVariableToProcessInstanceUsingPost
----
POST /action/task/setVariable
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|BodyParameter|allRequestParamsStr|allRequestParamsStr|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* text/plain

===== Produces

* */*

==== setVariableToProcessInstance
----
GET /action/task/setVariable
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|processInstanceId|processInstanceId|true|string|
|QueryParameter|key|key|true|string|
|QueryParameter|value|value|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

=== DebugCommonController - Дебаг И Тест Общий
:hardbreaks:
Debug Common Controller

==== /test/action/task/delete-processTest
----
GET /test/action/task/delete-processTest
----

===== Description
:hardbreaks:
#####  DebugCommonController: описания нет


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sProcessInstanceID|sProcessInstanceID|true|string|
|QueryParameter|sLogin|sLogin|false|string|
|QueryParameter|sReason|sReason|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== /test/sendAttachmentsByMail
----
GET /test/sendAttachmentsByMail
----

===== Description
:hardbreaks:
#####  DebugCommonController: описания нет


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sMailTo|sMailTo|false|string|
|QueryParameter|nID_Task|nID_Task|false|string|
|QueryParameter|sBody|sBody|false|string|
|QueryParameter|bHTML|bHTML|false|boolean|
|QueryParameter|naID_Attachment|naID_Attachment|false|string|
|QueryParameter|bUnisender|bUnisender|false|boolean|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== /rest/tasks/cancelTask
----
POST /rest/tasks/cancelTask
----

===== Description
:hardbreaks:
#####  DebugCommonController:


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Protected|nID_Protected|true|integer (int64)|
|QueryParameter|sInfo|sInfo|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* text/plain;charset=UTF-8

==== /test/action/getInfo
----
GET /test/action/getInfo
----

===== Description
:hardbreaks:
#####  DebugCommonController: 


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_TestType|sID_TestType|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* text/plain;charset=UTF-8

==== /test/action/loadPayments
----
GET /test/action/loadPayments
----

===== Description
:hardbreaks:
#####  DebugCommonController: 


===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== /test/action/testSheduleBuilderFlowSlots
----
GET /test/action/testSheduleBuilderFlowSlots
----

===== Description
:hardbreaks:
#####  DebugCommonController: описания нет


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Flow_ServiceData|nID_Flow_ServiceData|false|integer (int64)|
|QueryParameter|nID_ServiceData|nID_ServiceData|false|integer (int64)|
|QueryParameter|sDateStart|sDateStart|false|string|
|QueryParameter|sDateStop|sDateStop|false|string|
|QueryParameter|bAll|bAll|false|boolean|
|QueryParameter|nDays|nDays|false|integer (int32)|
|QueryParameter|sOperation|sOperation|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

=== FinanceCommonController -- Финансы Общие (в Т.ч. Платежи)
:hardbreaks:
Finance Common Controller

==== /finance/setPaymentStatus_TaskActiviti_Direct
----
GET /finance/setPaymentStatus_TaskActiviti_Direct
----

===== Description
:hardbreaks:
##### Контроллер платежей. Регистрация проведенного платежа - по прямому вызову


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Order|Строка-ИД заявки|true|string|
|QueryParameter|sID_PaymentSystem|Строка-ИД платежной системы|true|string|
|QueryParameter|sData|Строка со вспомогательными данными|true|string|
|QueryParameter|sPrefix|Cтрока-префикс платежа (если их несколько в рамках заявки)|false|string|
|QueryParameter|sID_Transaction|Строка-ИД транзакции|true|string|
|QueryParameter|sStatus_Payment|Строка-статуса платежа|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== /finance/redirectPaymentLiqpay
----
GET /finance/redirectPaymentLiqpay
----

===== Description
:hardbreaks:
##### Получение URL-а и параметров для отправки платежа через POST-запрос


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Merchant|Строка-ИД Мерчанта|true|string|
|QueryParameter|sSum|Сумма (разделитель копеек - точка)|false|string|
|QueryParameter|sID_Order|Строка-ИД заявки-платежа|false|string|
|QueryParameter|sDescription|Описание платежа|false|string|
|QueryParameter|sID_Currency|ИД валюты (3 символа)|false|string|
|QueryParameter|sURL_CallbackStatusNew|sURL_CallbackStatusNew|false|string|
|QueryParameter|sURL_CallbackPaySuccess|sURL_CallbackPaySuccess|false|string|
|QueryParameter|nID_Subject|номер-ИД субьекта|false|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== /finance/setPaymentStatus_TaskActiviti
----
POST /finance/setPaymentStatus_TaskActiviti
----

===== Description
:hardbreaks:
##### Контроллер платежей. Регистрация проведенного платежа - по колбэку от платежной системы


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Order|Строка-ИД заявки|true|string|
|QueryParameter|sID_PaymentSystem|Строка-ИД платежной системы|true|string|
|QueryParameter|sData|Строка со вспомогательными данными|true|string|
|QueryParameter|sPrefix|Строка-префикс платежа (если их несколько в рамках заявки)|false|string|
|BodyParameter|data|Строка-Данные от платежной системы|false|string|
|QueryParameter|signature|Строка-Подпись платежной системы|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== /finance/setPaymentStatus_TaskActiviti
----
POST /setPaymentStatus_TaskActiviti
----

===== Description
:hardbreaks:
##### Контроллер платежей. Регистрация проведенного платежа - по колбэку от платежной системы


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_Order|Строка-ИД заявки|true|string|
|QueryParameter|sID_PaymentSystem|Строка-ИД платежной системы|true|string|
|QueryParameter|sData|Строка со вспомогательными данными|true|string|
|QueryParameter|sPrefix|Строка-префикс платежа (если их несколько в рамках заявки)|false|string|
|BodyParameter|data|Строка-Данные от платежной системы|false|string|
|QueryParameter|signature|Строка-Подпись платежной системы|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

=== ObjectFileCommonController -- Обьекты Файлов Общие
:hardbreaks:
Object File Common Controller

==== Загрузки прикрепленного к заявке файла из постоянной базы
----
GET /object/file/download_file_from_storage_static
----

===== Description
:hardbreaks:
##### Пример:
 https://test.igov.org.ua/wf/service/object/file/download_file_from_storage_static?sId=111111&sFileName=111.txt&sType=text


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sId|sId|true|string|
|QueryParameter|sFileName|sFileName|true|string|
|QueryParameter|sType|sType|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== /dfs/getPatternFilled
----
POST /object/file/dfs/getPatternFilled
----

===== Description
:hardbreaks:
##### Контроллер сохранения заполненного шаблона в базу


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|BodyParameter|data|Список алиасов и значений из формы в json формате|false|object|
|QueryParameter|sID_Pattern|Ид файла-шаблона|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|object
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== Проверка ЭЦП на атачменте(файл) таски Activiti
----
GET /object/file/check_attachment_sign
----

===== Description
:hardbreaks:
##### Примеры:
https://test.region.igov.org.ua/wf/service/object/file/check_attachment_sign?nID_Task=7315073&nID_Attach=7315075
Ответ:

```json
{
  "state": "ok",
  "customer": {
    "inn": "1436057000",
    "fullName": "Сервіс зберігання сканкопій",
    "signatureData": {
      "name": "АЦСК ПАТ КБ «ПРИВАТБАНК»",
      "serialNumber": "0D84EDA1BB9381E80400000079DD02004A710800",
      "timestamp": "29.10.2015 13:45:33",
      "code": true,
      "desc": "ПІДПИС ВІРНИЙ",
      "dateFrom": "13.08.2015 11:24:31",
      "dateTo": "12.08.2016 23:59:59",
      "sn": "UA-14360570-1"
    },
    "organizations": [
      {
        "type": "edsOwner",
        "name": "ПАТ КБ «ПРИВАТБАНК»",
        "mfo": "14360570",
        "position": "Технологічний сертифікат",
        "ownerDesc": "Співробітник банку",
        "address": {
          "type": "factual",
          "state": "Дніпропетровська",
          "city": "Дніпропетровськ"
        }
      },
      {
        "type": "edsIsuer",
        "name": "ПУБЛІЧНЕ АКЦІОНЕРНЕ ТОВАРИСТВО КОМЕРЦІЙНИЙ БАНК «ПРИВАТБАНК»",
        "unit": "АЦСК",
        "address": {
          "type": "factual",
          "state": "Дніпропетровська",
          "city": "Дніпропетровськ"
        }
      }
    ]
  }
}

```

Ответ для несуществующей таски (nID_Task):

```json
{"code":"SYSTEM_ERR","message":"ProcessInstanceId for taskId '7315070' not found."}

```

Ответ для несуществующего атачмента (nID_Attach):

```json
{"code":"SYSTEM_ERR","message":"Attachment for taskId '7315073' not found."}

```

Ответ для атачмента который не имеет наложеной ЭЦП:

```json
{}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Task|ИД-номер таски|true|string|
|QueryParameter|nID_Attach|строка-ИД атачмента приложеного к таске|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== Загрузки прикрепленного к заявке файла из постоянной базы
----
GET /object/file/download_file_from_db
----

===== Description
:hardbreaks:
##### Пример:
 https://test.igov.org.ua/wf/service/object/file/download_file_from_db?taskId=82596&attachmentId=6726532&nFile=7


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|taskId|строка-ИД задачи|true|string|
|QueryParameter|attachmentId|строка-ID прикрепленного файла|false|string|
|QueryParameter|nFile|порядковый номер прикрепленного файла|false|integer (int32)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== GetAttachmentsFromRedis
----
GET /object/file/download_file_from_redis
----

===== Description
:hardbreaks:
#####  ObjectFileCommonController: описания нет


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|key|key|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Аплоад(upload) и прикрепление текстового файла в виде атачмента к таске Activiti
----
POST /object/file/upload_content_as_attachment
----

===== Description
:hardbreaks:
#####Пример: http://localhost:8080/wf/service/object/file/upload_content_as_attachment?nTaskId=24&sDescription=someText&sFileName=FlyWithMe.html

```json
Ответ без ошибок:
{
  "taskId": "38",
  "processInstanceId": null,
  "userId": "kermit",
  "name": "FlyWithMe.html",
  "id": "25",
  "type": "text/html;html",
  "description": "someText",
  "time": 1433539278957,
  "url": null
}

ID созданного attachment - "id": "25"

```

Ответ с ошибкой:

```json
{"code":"SYSTEM_ERR","message":"Cannot find task with id 384"}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nTaskId|строка-Логин пользователя|true|string|
|QueryParameter|sContentType|строка-MIME тип отправляемого файла (по умолчанию = "text/html")|false|string|
|QueryParameter|sDescription|строка-описание|true|string|
|QueryParameter|sFileName|sFileName|true|string|
|BodyParameter|sData|sData|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<AttachmentEntityI>>
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json

==== Проверка ЭЦП на файле хранящемся в Redis
----
GET /object/file/check_file_from_redis_sign
----

===== Description
:hardbreaks:
#####  Примеры:
https://test.region.igov.org.ua/wf/service/object/file/check_file_from_redis_sign?sID_File_Redis=d2993755-70e5-409e-85e5-46ba8ce98e1d

Ответ json описывающий ЭЦП:


```json
{
  "state": "ok",
  "customer": {
    "inn": "1436057000",
    "fullName": "Сервіс зберігання сканкопій",
    "signatureData": {
      "name": "АЦСК ПАТ КБ «ПРИВАТБАНК»",
      "serialNumber": "0D84EDA1BB9381E80400000079DD02004A710800",
      "timestamp": "29.10.2015 13:45:33",
      "code": true,
      "desc": "ПІДПИС ВІРНИЙ",
      "dateFrom": "13.08.2015 11:24:31",
      "dateTo": "12.08.2016 23:59:59",
      "sn": "UA-14360570-1"
    },
    "organizations": [
      {
        "type": "edsOwner",
        "name": "ПАТ КБ «ПРИВАТБАНК»",
        "mfo": "14360570",
        "position": "Технологічний сертифікат",
        "ownerDesc": "Співробітник банку",
        "address": {
          "type": "factual",
          "state": "Дніпропетровська",
          "city": "Дніпропетровськ"
        }
      },
      {
        "type": "edsIsuer",
        "name": "ПУБЛІЧНЕ АКЦІОНЕРНЕ ТОВАРИСТВО КОМЕРЦІЙНИЙ БАНК «ПРИВАТБАНК»",
        "unit": "АЦСК",
        "address": {
          "type": "factual",
          "state": "Дніпропетровська",
          "city": "Дніпропетровськ"
        }
      }
    ]
  }
}

```
Ответ для несуществующего ключа (sID_File_Redis):

```json
{"code":"SYSTEM_ERR","message":"File with sID_File_Redis 'd2993755-70e5-409e-85e5-46ba8ce98e1e' not found."}


```
Ответ для файла который не имеет наложеной ЭЦП:


```json
{}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sID_File_Redis|строка-ключ по которому можно получить файл из хранилища Redis|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* application/json;charset=UTF-8

==== Сервис для получения Attachment из execution
----
GET /object/file/download_file_from_db_execution
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|taskId|ИД-номер таски|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== moveAttachsToMongo
----
GET /object/file/moveAttachsToMongo
----

===== Description
:hardbreaks:
#####  ObjectFileCommonController: Перенос атачментов задач активити в mongo DB  
пробегается по всем активным задачам и переносит их атачменты в mongo DB (если они еще не там) 
и в самом объекте атачмента меняет айдишники атачментов на новые
Метод содержит необязательные параметры, которые определяют какие задачи обрабатывать
nStartFrom - порядковый номер задачи в списке всех задач, с которого начинать обработку
nChunkSize - количество задач, которые обрабатывать начиная или с первой или со значения nStartFrom. 
Задачи выюираются по 10 из базы, поэтому лучше делать значени nChunkSize кратным 10
nProcessId - обрабатывать задачу с заданным айдишником
Примеры:

https://test.region.igov.org.ua/wf/service/object/file/moveAttachsToMongo
Перенести все атачменты задач в Монго ДБ

https://test.region.igov.org.ua/wf/service/object/file/moveAttachsToMongo?nProcessId=9397569
Перенести атачменты процесса с ID 9397569 в Монго ДБ

https://test.region.igov.org.ua/wf/service/object/file/moveAttachsToMongo?nStartFrom=0&nChunkSize=10

Перенести аттачменты процесса с 0 по 10 в монго

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nStartFrom|Порядковый номер процесса с которого начинать обработку аттачментов|false|string|
|QueryParameter|nChunkSize|строка-размер блока для выборки процесса на обработку|false|string|
|QueryParameter|nProcessId|строка-ИД конкретного процесса|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== PutAttachmentsToRedis
----
POST /object/file/upload_file_to_redis
----

===== Description
:hardbreaks:
#####  Укладываем в редис multipartFileToByteArray


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|FormDataParameter|file|file|true|file|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* multipart/form-data

===== Produces

* */*

==== Аплоад(upload) и прикрепление файла в виде атачмента к таске Activiti
----
POST /object/file/upload_file_as_attachment
----

===== Description
:hardbreaks:
#####  Примеры: 
http://test.igov.org.ua/wf/service/object/file/upload_file_as_attachment?taskId=68&description=ololo

```json
Ответ без ошибок:
{
  "taskId": "38",
  "processInstanceId": null,
  "userId": "kermit",
  "name": "jmt.png",
  "id": "45",
  "type": "image/png;png",
  "description": "SomeDocumentDescription",
  "time": 1433539278957,
  "url": null
}

ID созданного attachment - "id": "45"


```
Ответ с ошибкой:


```json
{"code":"SYSTEM_ERR","message":"Cannot find task with id 384"}

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|taskId|ИД-номер таски|true|string|
|FormDataParameter|file|файл html. в html это имя элемента input типа file - <input name="file" type="file" />. в HTTP заголовках - Content-Disposition: form-data; name="file" ...|true|file|
|QueryParameter|description|строка-описание|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<AttachmentEntityI>>
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* multipart/form-data

===== Produces

* application/json

==== GetAttachmentsFromRedisBytes
----
GET /object/file/download_file_from_redis_bytes
----

===== Description
:hardbreaks:
#####  ObjectFileCommonController: описания нет


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|key|key|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Работа с файлами-шаблонами
----
GET /object/file/getPatternFile
----

===== Description
:hardbreaks:
#####  возвращает содержимое указанного файла с указанным типом контента (если он задан).
Если указанный путь неверен и файл не найден -- вернется соответствующая ошибка.

Примеры:

https://test.region.igov.org.ua/wf/service/object/file/getPatternFile?sPathFile=print//subsidy_zayava.html

ответ: вернется текст исходного кода файла-шаблона

https://test.region.igov.org.ua/wf/service/object/file/getPatternFile?sPathFile=print//subsidy_zayava.html&sContentType=text/html

ответ: файл-шаблон будет отображаться в виде html-страницы

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|sPathFile|строка-полный путь к файлу|true|string|
|QueryParameter|sContentType|строка-тип контента|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

=== SubjectMessageCommonController -- Сообщения Субьектов
:hardbreaks:
Subject Message Common Controller

==== callbackSMS
----
POST /subject/message/getCallbackSMS_PB
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|BodyParameter|soData_JSON|soData_JSON|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|201|Created|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* text/plain;charset=UTF-8

==== callbackSMS
----
GET /subject/message/getCallbackSMS_PB
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|BodyParameter|soData_JSON|soData_JSON|true|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|string
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* text/plain;charset=UTF-8

=== С — Действия Эскалаций
:hardbreaks:
Action Escalation Controller

==== Удаление записи функции эскалации по ее nID
----
GET /action/escalation/removeEscalationRuleFunction
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД функции  эскалации|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Record not found|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Запуск всех правил эскалаций
----
GET /action/escalation/runEscalation
----

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Выборка всех записей функции эскалации
----
GET /action/escalation/getEscalationRuleFunctions
----

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationRuleFunction>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Возврат одной записи функции эскалации по ее nID
----
GET /action/escalation/getEscalationRuleFunction
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД функции эскалации|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationRuleFunction>>
|401|Unauthorized|No Content
|403|Record not found|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавление/обновление записи функции эскалации
----
GET /action/escalation/setEscalationRuleFunction
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|ИД-номер (уникальный-автоитерируемый):
 - если nID не задан, то это создание записи;
 - если nID задан, но его нету — будет ошибка;
- если nID задан, и он есть — запись обновляется.
|false|integer (int64)|
|QueryParameter|sName|строка-название (Например "Отсылка уведомления на электронную почту")|true|string|
|QueryParameter|sBeanHandler|строка бина-обработчика|false|string|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationRuleFunction>>
|401|Unauthorized|No Content
|403|Record not found|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Возврат одной записи правила эскалации по ее nID
----
GET /action/escalation/getEscalationRule
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД правила эскалации|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationRule>>
|401|Unauthorized|No Content
|403|Record not found|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Возвращает список всех записей правил эскалации
----
GET /action/escalation/getEscalationRules
----

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationRule>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Запуск правила эскалации по его Ид
----
GET /action/escalation/runEscalationRule
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ид правила эскалации|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Удаление записи правила эскалации по ее nID
----
GET /action/escalation/removeEscalationRule
----

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|номер-ИД правила эскалации|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|No Content
|401|Unauthorized|No Content
|403|Record not found|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Возвращает массив объектов сущности по заданним параметрам
----
GET /action/escalation/getEscalationHistory
----

===== Description
:hardbreaks:
#####Примеры:
 Пример 1: https://test.igov.org.ua/wf/service/action/escalation/getEscalationHistory

Пример ответа:


```json
  [{
    "sDate":"2015-09-09 21:20:25.000",
    "nID":1,
    "nID_Process":9463,
    "nID_Process_Root":29193,
    "nID_UserTask":894,
    "nID_EscalationStatus":91
  }
  ...
  ]

```
Пример 2:
 https://test.igov.org.ua/wf/service/action/escalation/getEscalationHistory?nID_Process=6276&nID_Process_Root=57119&nID_UserTask=634&sDateStart=2014-11-24%2000:03:00&sDateEnd=2014-12-26%2000:03:00&nRowsMax=100

===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID_Process|номер-ИД процесса|false|integer (int64)|
|QueryParameter|nID_Process_Root|номер-ИД процесса (корневого)|false|integer (int64)|
|QueryParameter|nID_UserTask|номер-ИД юзертаски|false|integer (int64)|
|QueryParameter|sDateStart|строка дата начала выборки, в формате YYYY-MM-DD hh:mm:ss|false|string|
|QueryParameter|sDateEnd|строка дата конца выборки, в формате YYYY-MM-DD hh:mm:ss|false|string|
|QueryParameter|nRowsMax|максимальное число строк, по умолчанию 100 (защита - не более 5000)|false|integer (int32)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationHistory>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Возвращает массив объектов сущности EscalationStatus
----
GET /action/escalation/getEscalationStatuses
----

===== Description
:hardbreaks:
##### Пример: https://<server>/wf/service/action/escalation/getEscalationStatuses

Oтвет:


```json
[
{"sNote":"Отослано письмо","nID":1,"sID":"MailSent"},
{"sNote":"БП создан","nID":2,"sID":"BP_Created"},
{"sNote":"БП в процессе","nID":3,"sID":"BP_Process"},
{"sNote":"БП закрыт","nID":4,"sID":"BP_Closed"}
]

```


===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationStatus>> array
|401|Unauthorized|No Content
|403|Forbidden|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

==== Добавление/обновление записи правила эскалации
----
GET /action/escalation/setEscalationRule
----

===== Description
:hardbreaks:
##### ПРИМЕР:

```
https://test.region.igov.org.ua/wf/service/action/escalation/setEscalationRule?sID_BP=zaporoshye_mvk-1a&sID_UserTask=*&sCondition=nElapsedDays==nDaysLimit&soData={nDaysLimit:3,asRecipientMail:'test@email.com'}&sPatternFile=escalation/escalation_template.html&nID_EscalationRuleFunction=1


```
ОТВЕТ:

```json
  {
    "sID_BP":"zaporoshye_mvk-1a",
    "sID_UserTask":"*",
    "sCondition":"nElapsedDays==nDaysLimit",
    "soData":"{nDaysLimit:3,asRecipientMail:[test@email.com]}",
    "sPatternFile":"escalation/escalation_template.html",
    "nID":1008,
    "nID_EscalationRuleFunction":
    {"sBeanHandler":"EscalationHandler_SendMailAlert",
      "nID":1,
      "sName":"Send Email"
    }
  }

```


===== Parameters
[options="header"]
|===
|Type|Name|Description|Required|Schema|Default
|QueryParameter|nID|ИД-номер (уникальный-автоитерируемый):
- если nID не задан, то это создание записи
- если nID задан, но его нету -- будет ошибка "403. Record not found"
- если nID задан, и он есть -- запись обновляется
|false|integer (int64)|
|QueryParameter|sID_BP|ИД-строка бизнес-процесса|true|string|
|QueryParameter|sID_UserTask|ИД-строка юзертаски бизнеспроцесса (если указана * -- то выбираются все задачи из бизнес-процесса)|true|string|
|QueryParameter|sCondition|строка-условие (на языке javascript )|true|string|
|QueryParameter|soData|строка JSON-обьектобьект, с данными|true|string|
|QueryParameter|sPatternFile|строка файла-шаблона (примеры тут)|true|string|
|QueryParameter|nID_EscalationRuleFunction|ИД-номер функции эскалации|true|integer (int64)|
|===

===== Responses
[options="header"]
|===
|HTTP Code|Description|Schema
|200|OK|<<EscalationRule>>
|401|Unauthorized|No Content
|403|Record not found|No Content
|404|Not Found|No Content
|===

===== Consumes

* application/json

===== Produces

* */*

